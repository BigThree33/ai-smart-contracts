import{C as e,b as a,d as t,w as r,i as s,o,e as l,f as d,E as i,F as c,G as n,H as u,k as f,q as m}from"./index-BPWpFivt.js";import{b as g,s as _,a as h}from"./api.z3z0JoG3.js";import{_ as p}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=p({data:()=>({orderList:[],loading:!1,error:null,source:"",recordType:"transaction"}),onLoad(e){this.source=e.source||"pledge",this.recordType=e.type||"transaction",console.log("Page loaded with source:",this.source,"type:",this.recordType),this.fetchOrderList()},methods:{goBack(){e({delta:1})},getPageTitle(){return"account"===this.source?"revenue"===this.recordType?"Revenue Record":"Transaction Record":"Order List"},async fetchOrderList(){this.loading=!0,this.error=null;try{g.showLoading("Loading...");const e=_.getToken();if(console.log("Current token:",e),!e)throw new Error("Authorization token not found, please reconnect wallet");let a;if(console.log("Sending order list request, token:",e,"source:",this.source,"type:",this.recordType),a="account"===this.source?"revenue"===this.recordType?await h.record.getRevenueRecord("4080000"):await h.record.getCashRecord():await h.record.getPledgeOrderList(),console.log("Order list response:",a),1===a.code){if(a.info&&a.info.includes("token"))throw console.log("Token validation failed, clearing token"),_.clearToken(),new Error("Session expired, please reconnect wallet");throw new Error(a.info||"Request failed")}let t=[];"account"===this.source?"revenue"===this.recordType?a&&a.zhiya&&Array.isArray(a.zhiya)&&(t=a.zhiya.map((e=>this.mapRevenueRecordData(e)))):a&&a.zhiya&&Array.isArray(a.zhiya)&&(t=a.zhiya.map((e=>this.mapCashRecordData(e)))):a&&a.data&&Array.isArray(a.data)&&(t=a.data),this.orderList=t,console.log("Order list loaded successfully, count:",this.orderList.length)}catch(e){console.error("Failed to get order list:",e),this.error=e.message||"Network request failed",e.message.includes("token")||e.message.includes("Session")?(g.showError("Please reconnect wallet"),setTimeout((()=>{a({url:"/pages/wallet/connect"})}),2e3)):g.showError(this.error)}finally{this.loading=!1,g.hideLoading()}},mapCashRecordData(e){return{id:e.id,type:e.type||"3",title:e.info||"Cash Record",amount:e.amount,bilv:e.bilv||"0",addtime:e.addtime,endtime:e.addtime,order_id:e.id,status:this.getCashRecordStatus(e),address:e.address,min_amount:e.min_amount,uid:e.uid,info:e.info}},mapRevenueRecordData(e){return{id:e.id||e.uid||Math.random().toString(),type:e.type||"5",title:e.info||"Revenue Record",amount:e.amount,bilv:e.bilv||"0",addtime:e.addtime,endtime:e.addtime,order_id:e.id||e.uid,status:this.getRevenueRecordStatus(e),address:e.address,min_amount:e.min_amount,uid:e.uid,info:e.info}},getRevenueRecordStatus:e=>"Profit"===e.info||"利润"===e.info||"推荐收益"===e.info?"1":"0",getCashRecordStatus:e=>"Recharge"===e.info||"充值"===e.info?"1":"0",formatAmount:e=>e?parseFloat(e).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",formatTime(e){if(!e)return"";return new Date(1e3*parseInt(e)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})},getOrderTypeTag:e=>({1:"LP",2:"ST",3:"TF",4:"AMM"}[e]||"TF"),getStatusText:e=>({0:"in progress",1:"completed",2:"expired",3:"cancelled"}[e]||"unknown"),getStatusClass:e=>({0:"in-progress",1:"completed",2:"expired",3:"cancelled"}[e]||"in-progress"),formatPercentage(e){if(!e)return"0";const a=e.toString().replace(/%$/,""),t=parseFloat(a);return Number.isInteger(t)||t%1==0?t.toString():t.toString().replace(/\.?0+$/,"")}}},[["render",function(e,a,g,_,h,p){const y=f,w=s;return o(),t(w,{class:"order-list-container"},{default:r((()=>[l(w,{class:"header"},{default:r((()=>[l(w,{class:"back-button",onClick:p.goBack},{default:r((()=>[l(y,{class:"back-icon"},{default:r((()=>[d("←")])),_:1})])),_:1},8,["onClick"]),l(y,{class:"page-title"},{default:r((()=>[d(i(p.getPageTitle()),1)])),_:1})])),_:1}),h.loading?(o(),t(w,{key:0,class:"loading-container"},{default:r((()=>[l(y,{class:"loading-text"},{default:r((()=>[d("Loading...")])),_:1})])),_:1})):h.error?(o(),t(w,{key:1,class:"error-container"},{default:r((()=>[l(y,{class:"error-text"},{default:r((()=>[d(i(h.error),1)])),_:1}),l(w,{class:"retry-button",onClick:p.fetchOrderList},{default:r((()=>[l(y,null,{default:r((()=>[d("Retry")])),_:1})])),_:1},8,["onClick"])])),_:1})):(o(),t(w,{key:2},{default:r((()=>[0===h.orderList.length?(o(),t(w,{key:0,class:"empty-container"},{default:r((()=>[l(y,{class:"empty-text"},{default:r((()=>[d("No order records")])),_:1})])),_:1})):(o(!0),c(u,{key:1},n(h.orderList,(e=>(o(),t(w,{class:"order-card",key:e.id},{default:r((()=>["account"===h.source?(o(),c(u,{key:0},[l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Type")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(e.info),1)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("ID")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(e.id),1)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Amount")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatAmount(e.amount)),1),l(y,{class:"currency"},{default:r((()=>[d("USDT")])),_:1})])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Time")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatTime(e.addtime)),1)])),_:2},1024)])),_:2},1024)],64)):(o(),c(u,{key:1},[l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Order Type")])),_:1}),l(w,{class:"tag-container"},{default:r((()=>[l(y,{class:"tag"},{default:r((()=>[d(i(p.getOrderTypeTag(e.type)),1)])),_:2},1024),l(y,{class:"product-name"},{default:r((()=>[d(i(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Escrow amount")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatAmount(e.amount)),1),l(y,{class:"currency"},{default:r((()=>[d("USDT")])),_:1})])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Profit")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatPercentage(e.bilv)),1),l(y,{class:"currency"},{default:r((()=>[d("%")])),_:1})])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Order time")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatTime(e.addtime)),1)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Expire date")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(p.formatTime(e.endtime)),1)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Order ID")])),_:1}),l(y,{class:"value"},{default:r((()=>[d(i(e.order_id),1)])),_:2},1024)])),_:2},1024),l(w,{class:"order-row"},{default:r((()=>[l(y,{class:"label"},{default:r((()=>[d("Order Status")])),_:1}),l(y,{class:m(["status-value",p.getStatusClass(e.status)])},{default:r((()=>[d(i(p.getStatusText(e.status)),1)])),_:2},1032,["class"])])),_:2},1024),l(w,{class:"social-icons"},{default:r((()=>[l(w,{class:"social-icon facebook"},{default:r((()=>[d("f")])),_:1}),l(w,{class:"social-icon twitter"},{default:r((()=>[d("Ⓜ")])),_:1}),l(w,{class:"social-icon telegram"},{default:r((()=>[d("📱")])),_:1}),l(w,{class:"social-icon youtube"},{default:r((()=>[d("🎭")])),_:1}),l(w,{class:"social-icon whatsapp"},{default:r((()=>[d("🎯")])),_:1}),l(w,{class:"social-icon bitcoin"},{default:r((()=>[d("₿")])),_:1}),l(w,{class:"social-icon other"},{default:r((()=>[d("🌟")])),_:1})])),_:1})],64))])),_:2},1024)))),128))])),_:1}))])),_:1})}],["__scopeId","data-v-68517623"]]);export{y as default};
