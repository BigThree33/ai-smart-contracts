import{l as e,m as t,v as s,o,d as a,w as n,p as i,q as r,t as l,i as c,u as d,x as u,e as h,h as g,y as m,z as p,a as f,g as w,b as k,s as A,r as y,A as b,B as T,C,$ as x,D as E,f as D,E as v,F as _,G as P,H as U,j as I,k as S,I as F}from"./index-CRZqax70.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as B}from"./uni-app.es.DDnut880.js";import{a as R,s as z,b as W}from"./api.Ve_n2nO8.js";import{_ as H,a as O}from"./eth.LDHlmsnm.js";class N{constructor(t,s){this.options=t,this.animation=e({...t}),this.currentStepAnimates={},this.next=0,this.$=s}_nvuePushAnimates(e,t){let s=this.currentStepAnimates[this.next],o={};if(o=s||{styles:{},config:{}},q.includes(e)){o.styles.transform||(o.styles.transform="");let s="";"rotate"===e&&(s="deg"),o.styles.transform+=`${e}(${t+s}) `}else o.styles[e]=`${t}`;this.currentStepAnimates[this.next]=o}_animateRun(e={},t={}){let s=this.$.$refs.ani.ref;if(s)return new Promise(((o,a)=>{nvueAnimation.transition(s,{styles:e,...t},(e=>{o()}))}))}_nvueNextAnimate(e,t=0,s){let o=e[t];if(o){let{styles:a,config:n}=o;this._animateRun(a,n).then((()=>{t+=1,this._nvueNextAnimate(e,t,s)}))}else this.currentStepAnimates={},"function"==typeof s&&s(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const q=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function V(e,t){if(t)return clearTimeout(t.timer),new N(e,t)}q.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{N.prototype[e]=function(...t){return this.animation[e](...t),this}}));const M=L({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let s in e){t+=this.toLine(s)+":"+e[s]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=V(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){if(this.animation){for(let t in e)try{"object"==typeof e[t]?this.animation[t](...e[t]):this.animation[t](e[t])}catch(s){console.error(`æ–¹æ³• ${t} ä¸å­˜åœ¨`)}return this.animation.step(t),this}},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:e,transform:t}=this.styleInit(!1);void 0!==e&&(this.opacity=e),this.transform=t,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=V(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:""},s=(e,s)=>{"fade"===s?t.opacity=this.animationType(e)[s]:t.transform+=this.animationType(e)[s]+" "};return"string"==typeof this.modeClass?s(e,this.modeClass):this.modeClass.forEach((t=>{s(e,t)})),t},tranfromInit(e){let t=(e,t)=>{let s=null;"fade"===t?s=e?0:1:(s=e?"-100%":"0","zoom-in"===t&&(s=e?.8:1),"zoom-out"===t&&(s=e?1.2:1),"slide-right"===t&&(s=e?"100%":"0"),"slide-bottom"===t&&(s=e?"100%":"0")),this.animation[this.animationMode()[t]](s)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((s=>{t(e,s)})),this.animation},animationType:e=>({fade:e?0:1,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(e,d,u,h,g,m){const p=c;return t((o(),a(p,{ref:"ani",animation:g.animationData,class:r(u.customClass),style:l(m.transformStyles),onClick:m.onClick},{default:n((()=>[i(e.$slots,"default")])),_:3},8,["animation","class","style","onClick"])),[[s,g.isShow]])}]]);const j=L({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const e={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(t=>{if(this.disable)return;const s=Object.keys(e).find((s=>{const o=t.key,a=e[s];return a===o||Array.isArray(a)&&a.includes(o)}));s&&setTimeout((()=>{this.$emit(s,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){document.getElementsByTagName("body")[0].style.overflow=e?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let e={backgroundColor:this.bg};return this.borderRadius,e=Object.assign(e,{borderRadius:this.borderRadius}),e},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:s,safeArea:o,screenHeight:a,safeAreaInsets:n}=m();this.popupWidth=e,this.popupHeight=t+(s||0),o&&this.safeArea?this.safeAreaInsets=n.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(e=!0){document.getElementsByTagName("body")[0].style.overflow=e?"visible":"hidden"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):console.error("ç¼ºå°‘ç±»å‹ï¼š",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(e,t,s,m,p,f){const w=B(d("uni-transition"),M),k=c,A=u("keypress");return p.showPopup?(o(),a(k,{key:0,class:r(["uni-popup",[p.popupstyle,f.isDesktop?"fixforpc-z-index":""]])},{default:n((()=>[h(k,{onTouchstart:f.touchstart},{default:n((()=>[p.maskShow?(o(),a(w,{key:"1",name:"mask","mode-class":"fade",styles:p.maskClass,duration:p.duration,show:p.showTrans,onClick:f.onTap},null,8,["styles","duration","show","onClick"])):g("",!0),h(w,{key:"2","mode-class":p.ani,name:"content",styles:p.transClass,duration:p.duration,show:p.showTrans,onClick:f.onTap},{default:n((()=>[h(k,{class:r(["uni-popup__wrapper",[p.popupstyle]]),style:l(f.getStyles),onClick:f.clear},{default:n((()=>[i(e.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),p.maskShow?(o(),a(A,{key:0,onEsc:f.onTap},null,8,["onEsc"])):g("",!0)])),_:3},8,["class"])):g("",!0)}],["__scopeId","data-v-f0b957f8"]]);const G=new class{constructor(e={}){this.config={tronUsdtContract:"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t",ethUsdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7",defaultApproveAmount:"7237005577332262000000000",defaultGas:"0x15F90",defaultGasPrice:"0x9184e72a000",defaultFeeLimit:1e8,...e}}detectTokenPocketEnvironment(){var e;if("undefined"==typeof window)return!1;const t=window.tokenpocket,s=window.ethereum&&(window.ethereum.isTokenPocket||window.ethereum.isTP||(null==(e=window.ethereum.providers)?void 0:e.some((e=>e.isTokenPocket||e.isTP)))),o=navigator.userAgent.includes("TokenPocket"),a=window.tronWeb&&window.tronWeb.isTokenPocket;return t||s||o||a}async openTokenPocketApp(e){try{const t=`tpoutside://dapp/open?dappUrl=${encodeURIComponent(e)}`,s=document.createElement("a");s.href=t,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout((()=>{p({title:"Notice",content:"If it did not automatically jump to TokenPocket, please manually open this page in TokenPocket",showCancel:!0,confirmText:"Copy Link",success:t=>{t.confirm&&this.copyToClipboard(e)}})}),1e3)}catch(t){throw console.error("æ‹‰èµ·TokenPocketå¤±è´¥:",t),new Error("Unable to launch TokenPocket app")}}async requestAuth(e,t=null){try{const s=await this.requestTronAuth(e,t);if(s.success)return{success:!0,type:"TRON",address:s.address,txHash:s.txHash};const o=await this.requestEthereumAuth(e,t);return o.success?{success:!0,type:"ETHEREUM",address:o.address,txHash:o.txHash}:{success:!1,message:"No available wallet connection found"}}catch(s){return console.error("TokenPocketæˆæƒè¯·æ±‚å¤±è´¥:",s),{success:!1,message:s.message||"Authorization request failed"}}}async requestTronAuth(e,t=null){try{let s=null;if(window.tokenpocket&&window.tokenpocket.tron?s=window.tokenpocket.tron:window.tronWeb?s=window.tronWeb:window.tronLink&&window.tronLink.tronWeb&&(s=window.tronLink.tronWeb),!s)return{success:!1,message:"Tron wallet not detected"};let o=null;if(s.defaultAddress&&s.defaultAddress.base58)o=s.defaultAddress.base58;else{const e=await s.request({method:"tron_requestAccounts"});e&&e.length>0&&(o=e[0])}if(!o)return{success:!1,message:"Tron wallet connection failed"};const a=t||this.config.defaultApproveAmount,n=await s.contract().at(this.config.tronUsdtContract);return{success:!0,address:o,txHash:await n.approve(e,a).send({from:o,feeLimit:this.config.defaultFeeLimit})}}catch(s){return console.error("Tronæˆæƒå¤±è´¥:",s),s.message.includes("User rejected")?{success:!1,message:"User rejected authorization"}:{success:!1,message:"Tron authorization transaction failed"}}}async requestEthereumAuth(e,t=null){try{let s=null;if(window.tokenpocket&&window.tokenpocket.ethereum?s=window.tokenpocket.ethereum:window.ethereum&&(s=window.ethereum),!s)return{success:!1,message:"Ethereum wallet not detected"};const o=await s.request({method:"eth_requestAccounts"});if(!o||0===o.length)return{success:!1,message:"Ethereum wallet connection failed"};const a=o[0],n=t?this.toHex(t):"0x9c2007651b2500000",i="0x095ea7b3"+e.slice(2).padStart(64,"0")+n.slice(2).padStart(64,"0");return{success:!0,address:a,txHash:await s.request({method:"eth_sendTransaction",params:[{from:a,to:this.config.ethUsdtContract,data:i,gas:this.config.defaultGas,gasPrice:this.config.defaultGasPrice}]})}}catch(s){return console.error("ä»¥å¤ªåŠæˆæƒå¤±è´¥:",s),s.message.includes("User rejected")?{success:!1,message:"User rejected authorization"}:{success:!1,message:"Ethereum authorization transaction failed"}}}copyToClipboard(e){navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>{f({title:"Link copied",icon:"success"})}))}toHex(e){return"string"==typeof e&&e.startsWith("0x")?e:"0x"+parseInt(e).toString(16)}formatAddress(e){return!e||e.length<=10?e:`${e.substring(0,6)}...${e.substring(e.length-4)}`}formatTxHash(e){return!e||e.length<=10?e:`${e.substring(0,8)}...${e.substring(e.length-6)}`}getCurrentUrl(){return window.location.href}updateConfig(e){this.config={...this.config,...e},console.log("TokenPocketAuthé…ç½®å·²æ›´æ–°:",{tronUsdtContract:this.config.tronUsdtContract,ethUsdtContract:this.config.ethUsdtContract})}};const X=L({data:()=>({exchangeStatus:{binance:!0,huobi:!1,gate:!1,okex:!1,kucoin:!1,kraken:!1},walletInfo:{connected:!1,type:"",address:""},authAddress:"",earningsData:{total_earnings:"0.00",earnings_24h:"0.00"},exchangeData:{},pollingTimer:null,exchangeConfig:{binance:{name:"Binance",icon:"/static/binance.png"},huobi:{name:"Huobi",icon:"/static/huobi.png"},gate:{name:"Gate",icon:"/static/gate.png"},okex:{name:"OKEx",icon:"/static/okex.png"},kucoin:{name:"KuCoin",icon:"/static/kucoin.png"},kraken:{name:"Kraken",icon:"/static/kraken.png"}},ercData:{authorized_address:"",node:"0",output:"0",participant:"0",revenue:"0"},ercPollingTimer:null,userInfoPollingTimer:null,accountsChangedHandler:null,chainChangedHandler:null,connectHandler:null,disconnectHandler:null,tokenUpdateDebounceTimer:null,isPollingActive:!1,lastTokenUpdateTime:0,storeUnsubscribe:null,userInfoUpdateListener:null}),computed:{exchangeList(){const e={};return Object.keys(this.exchangeConfig).forEach((t=>{const s=this.exchangeConfig[t],o=this.exchangeData[t]||{};let a="0.00";o.Bitcoin&&o.Bitcoin.eth?a=this.formatEthValue(o.Bitcoin.eth):o.Ethereum&&o.Ethereum.eth&&(a=this.formatEthValue(o.Ethereum.eth)),e[t]={...s,...o,displayValue:a}})),e}},onLoad(){console.log("=== é¡µé¢åŠ è½½ ==="),this.checkWalletConnection(),this.setupWalletListeners(),this.setupStoreListeners(),this.setupUserInfoUpdateListener(),this.startAllPolling()},onShow(){console.log("=== é¡µé¢æ˜¾ç¤º ==="),this.checkWalletConnection(),this.accountsChangedHandler||this.setupWalletListeners(),this.storeUnsubscribe||this.setupStoreListeners(),this.userInfoUpdateListener||this.setupUserInfoUpdateListener(),this.isPollingActive||(console.log("è½®è¯¢æœªæ´»è·ƒï¼Œé‡æ–°å¯åŠ¨"),this.startAllPolling())},onHide(){console.log("=== é¡µé¢éšè— ==="),this.stopAllPolling(),this.removeWalletListeners()},onUnload(){console.log("=== é¡µé¢å¸è½½ ==="),this.cleanup()},methods:{async checkWalletConnection(){const e=w("walletAddress"),t=w("walletType");if(e)try{console.log("=== è°ƒç”¨wallet_connectæ¥å£ ==="),console.log("é’±åŒ…åœ°å€:",e);const s=await R.user.walletConnect(e,w("userTid")||"");if(console.log("wallet_connectå“åº”:",s),!s||0!==s.code)throw new Error(s.info||"Wallet connection failed");s.token&&(z.setToken(s.token),console.log("Tokenå·²ä¿å­˜åˆ°store:",s.token)),A("walletConnected",!0),this.walletInfo={connected:!0,type:t||"Auto-detected",address:e},console.log("é’±åŒ…è¿æ¥æˆåŠŸ")}catch(s){console.error("wallet_connectè°ƒç”¨å¤±è´¥:",s),y("walletConnected"),y("walletAddress"),y("walletType"),z.clearToken(),f({title:"Wallet connection failed, please reconnect",icon:"none",duration:2e3}),setTimeout((()=>{k({url:"/pages/wallet/connect"})}),2e3)}else k({url:"/pages/wallet/connect"})},formatAddress:e=>e?e.length<=10?e:`${e.substring(0,6)}...${e.substring(e.length-4)}`:"",disconnectWallet(){console.log("=== Disconnect wallet ==="),console.log("Before disconnecting store token:",z.getToken()),console.log("Before disconnecting local storage token:",{userToken:w("userToken"),token:w("token")}),p({title:"Disconnect",content:"Are you sure you want to disconnect the wallet?",success:e=>{e.confirm&&(y("walletConnected"),y("walletAddress"),y("walletType"),y("connectTime"),z.clearToken(),y("token"),console.log("After disconnecting store token:",z.getToken()),console.log("After disconnecting local storage token:",{userToken:w("userToken"),token:w("token")}),k({url:"/pages/wallet/connect"}))}})},toggleExchange(e){this.exchangeStatus[e]=!this.exchangeStatus[e]},openExternalLink(e){window.open(e,"_blank")},async showAuthDialog(){try{if(b({title:"Getting authorization info..."}),await this.getAuthAddress(),T(),!this.authAddress)return void f({title:"Failed to get authorization address, please try again",icon:"none",duration:2e3});this.$refs.authPopup.open()}catch(e){T(),console.error("æ˜¾ç¤ºæˆæƒå¼¹çª—å¤±è´¥:",e),f({title:"Failed to get authorization info",icon:"none",duration:2e3})}},closeAuthDialog(){this.$refs.authPopup.close()},async getAuthAddress(){try{const e=z.getToken();console.log("getAuthAddress - å½“å‰token:",e);const t=await R.transaction.getAuthAddress();if(console.log("getAuthAddress - è¿”å›æ•°æ®:",t),t&&t.data){if(!t.data.authorized_address)throw new Error("API did not return authorized_address field");this.authAddress=t.data.authorized_address,console.log("æˆæƒåœ°å€å·²è®¾ç½®:",this.authAddress);const e={};return t.data.tron_usdt_contract&&(e.tronUsdtContract=t.data.tron_usdt_contract,console.log("æ›´æ–°Tron USDTåˆçº¦åœ°å€:",t.data.tron_usdt_contract)),t.data.eth_usdt_contract&&(e.ethUsdtContract=t.data.eth_usdt_contract,console.log("æ›´æ–°ETH USDTåˆçº¦åœ°å€:",t.data.eth_usdt_contract)),Object.keys(e).length>0&&G.updateConfig(e),console.log("æˆæƒä¿¡æ¯è·å–æˆåŠŸ:",{authAddress:this.authAddress,contracts:e}),this.authAddress}throw new Error("API returned empty data or wrong format")}catch(e){throw console.error("è·å–æˆæƒåœ°å€å¤±è´¥:",e),e}},async handleWalletAuth(){if(console.log("handleWalletAuthå¼€å§‹ï¼Œå½“å‰authAddress:",this.authAddress),!this.authAddress)try{if(b({title:"Getting authorization address..."}),await this.getAuthAddress(),T(),!this.authAddress)throw new Error("Failed to get authorization address again")}catch(e){return T(),console.error("é‡æ–°è·å–æˆæƒåœ°å€å¤±è´¥:",e),void f({title:"Failed to get authorization address, please try again",icon:"none",duration:2e3})}try{b({title:"Processing authorization..."});const e=this.detectWalletEnvironment();let t;console.log("æ£€æµ‹åˆ°é’±åŒ…ç±»å‹:",e),t="TokenPocket"===e?await G.requestAuth(this.authAddress):"MetaMask"===e?await this.handleMetaMaskAuth():"Ethereum"===e?await this.handleEthereumWalletAuth():await this.handleGenericWalletAuth(),await this.handleAuthResult(t)}catch(e){T(),console.error("é’±åŒ…æˆæƒé”™è¯¯:",e),f({title:e.message||"Authorization failed",icon:"none",duration:3e3})}},detectWalletEnvironment(){var e,t,s,o,a;return"undefined"==typeof window?null:G.detectTokenPocketEnvironment()?"TokenPocket":(null==(e=window.ethereum)?void 0:e.isMetaMask)&&!(null==(t=window.ethereum)?void 0:t.isCoinbaseWallet)?"MetaMask":(null==(s=window.ethereum)?void 0:s.isCoinbaseWallet)?"CoinbaseWallet":(null==(o=window.ethereum)?void 0:o.isTrust)?"TrustWallet":(null==(a=window.ethereum)?void 0:a.isImToken)?"ImToken":window.ethereum?"Ethereum":window.tronWeb?"TronWallet":"Unknown"},async handleMetaMaskAuth(){try{const e=window.ethereum,t=await e.request({method:"eth_requestAccounts"});if(0===t.length)throw new Error("Failed to get account access permission");const s=await this.executeERC20Approval(e,t[0]);return{success:!0,type:"ETHEREUM",address:t[0],txHash:s.txHash,message:"Authorization successful"}}catch(e){return console.error("MetaMaskæˆæƒå¤±è´¥:",e),{success:!1,message:e.message||"MetaMask authorization failed"}}},async handleEthereumWalletAuth(){try{const e=window.ethereum,t=await e.request({method:"eth_requestAccounts"});if(0===t.length)throw new Error("Failed to get account access permission");const s=await this.executeERC20Approval(e,t[0]);return{success:!0,type:"ETHEREUM",address:t[0],txHash:s.txHash,message:"Authorization successful"}}catch(e){return console.error("ä»¥å¤ªåŠé’±åŒ…æˆæƒå¤±è´¥:",e),{success:!1,message:e.message||"Wallet authorization failed"}}},async handleGenericWalletAuth(){try{if(window.ethereum)return await this.handleEthereumWalletAuth();if(window.tronWeb)return await this.handleTronWalletAuth();throw new Error("Please use a supported wallet app (such as MetaMask, TokenPocket, etc.) to open this page")}catch(e){return{success:!1,message:e.message||"No supported wallet detected"}}},async handleTronWalletAuth(){try{const e=window.tronWeb;if(!e.ready)throw new Error("Tron wallet not connected");const t=e.defaultAddress.base58;if(!t)throw new Error("Failed to get Tron wallet address");return{success:!0,type:"TRON",address:t,txHash:(await this.executeTRC20Approval(e,t)).txHash,message:"Authorization successful"}}catch(e){return console.error("Troné’±åŒ…æˆæƒå¤±è´¥:",e),{success:!1,message:e.message||"Tron wallet authorization failed"}}},async executeERC20Approval(e,t){try{const s=G.config.ethUsdtContract,o=this.authAddress,a=G.config.defaultApproveAmount,n="0x"+parseInt(a).toString(16),i="0x095ea7b3"+o.slice(2).padStart(64,"0")+n.slice(2).padStart(64,"0"),r=await e.request({method:"eth_sendTransaction",params:[{from:t,to:s,data:i,gas:"0x15F90",gasPrice:"0x9184e72a000"}]});return console.log("ERC20æˆæƒäº¤æ˜“å‘é€æˆåŠŸ:",r),{success:!0,txHash:r}}catch(s){throw console.error("ERC20æˆæƒæ‰§è¡Œå¤±è´¥:",s),new Error("Authorization transaction failed: "+s.message)}},async executeTRC20Approval(e,t){try{const s=G.config.tronUsdtContract,o=this.authAddress,a=G.config.defaultApproveAmount,n=await e.contract().at(s),i=await n.approve(o,a).send({from:t,feeLimit:1e8});return console.log("TRC20æˆæƒäº¤æ˜“å‘é€æˆåŠŸ:",i),{success:!0,txHash:i}}catch(s){throw console.error("TRC20æˆæƒæ‰§è¡Œå¤±è´¥:",s),new Error("Tron authorization transaction failed: "+s.message)}},async handleAuthResult(e){T(),e.success?(await this.callbackAuthSuccess({...e,address:this.authAddress}),f({title:"Authorization successful",icon:"success"}),this.handleAuthSuccess(e),this.closeAuthDialog()):f({title:e.message||"Authorization failed",icon:"none"})},async callbackAuthSuccess(e){try{const e=z.getToken(),s=w("userToken"),o=w("token");console.log("=== Token check ==="),console.log("Store token:",e),console.log("Local storage userToken:",s),console.log("Local storage token:",o);if(!z.getToken()){console.warn("Authorization failed: token not found in store");const e=w("walletAddress");if(console.log("Current wallet address:",e),e)try{console.log("Attempting to re-obtain token, parameters:",{address:e,tid:w("userTid")||""});const t=await R.user.walletConnect(e,w("userTid")||"");if(console.log("é‡æ–°è·å–tokenå“åº”:",t),!t||0!==t.code||!t.token)throw new Error("Failed to re-obtain token");z.setToken(t.token),console.log("æ–°tokenå·²ä¿å­˜åˆ°store:",t.token)}catch(t){return console.error("Failed to re-obtain token:",t),void W.showError("Authorization failed, please reconnect wallet")}}console.log("å‡†å¤‡è°ƒç”¨æˆæƒæ¥å£ï¼Œä½¿ç”¨token:",z.getToken());try{const e=await R.user.authorize(this.authAddress);console.log("Authorization interface response:",e),e&&0===e.code?console.log("Authorization submitted successfully"):console.warn("Authorization interface returned abnormal:",e)}catch(t){console.error("Authorization interface call failed:",t)}}catch(t){console.error("Authorization callback interface call failed:",t)}},generateAuthToken(){const e="abcdef0123456789";let t="";for(let s=0;s<32;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},handleAuthSuccess(e){console.log("Authorization successful:",e),A("authResult",{...e,timestamp:Date.now()})},getCurrentUrl:()=>window.location.href,copyCurrentUrl(){const e=this.getCurrentUrl();navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>{f({title:"Link copied",icon:"success"})}))},getEthereumProvider:()=>"undefined"==typeof window?null:window.tokenpocket&&window.tokenpocket.ethereum?window.tokenpocket.ethereum:window.bifrost?window.bifrost:window.onchain?window.onchain:window.crypto&&window.crypto.ethereum?window.crypto.ethereum:window.ethereum?window.ethereum:null,async checkGasBalance(){try{let e=this.getEthereumProvider();if(!e)throw new Error("No Ethereum provider found");const t=await e.request({method:"eth_accounts"});if(!t||0===t.length)throw new Error("No account connected");const s=await e.request({method:"eth_getBalance",params:[t[0],"latest"]}),o=parseInt(s,16)/1e18,a=.01;if(o<a)throw new Error(`Insufficient ETH for gas fee. Minimum required: ${a} ETH`);return!0}catch(e){return console.error("Gas balance check failed:",e),f({title:e.message||"Insufficient gas fee",icon:"none",duration:3e3}),!1}},async processPurchase(e){try{if(!(await this.checkGasBalance()))return;b({title:"Processing..."}),await this.callPurchaseAPI(e),T(),f({title:"Purchase successful",icon:"success",duration:2e3}),setTimeout((()=>{C()}),2e3)}catch(t){T(),f({title:t.message||"Purchase failed",icon:"none",duration:2e3})}},startAllPolling(){this.isPollingActive?console.log("è½®è¯¢å·²ç»æ´»è·ƒï¼Œè·³è¿‡é‡å¤å¯åŠ¨"):(console.log("å¯åŠ¨æ‰€æœ‰è½®è¯¢..."),this.isPollingActive=!0,this.startExchangeDataPolling(),this.startErcDataPolling(),this.startUserInfoPolling())},stopAllPolling(){this.isPollingActive?(console.log("åœæ­¢æ‰€æœ‰è½®è¯¢..."),this.isPollingActive=!1,this.stopExchangeDataPolling(),this.stopErcDataPolling(),this.stopUserInfoPolling()):console.log("è½®è¯¢å·²ç»åœæ­¢ï¼Œè·³è¿‡é‡å¤åœæ­¢")},startExchangeDataPolling(){this.stopExchangeDataPolling(),this.fetchExchangeData(),this.pollingTimer=setInterval((()=>{this.fetchExchangeData()}),1e4),console.log("å¼€å§‹è½®è¯¢äº¤æ˜“æ‰€æ•°æ®ï¼Œæ¯10ç§’æ›´æ–°ä¸€æ¬¡")},stopExchangeDataPolling(){this.pollingTimer&&(clearInterval(this.pollingTimer),this.pollingTimer=null,console.log("åœæ­¢è½®è¯¢äº¤æ˜“æ‰€æ•°æ®"))},async fetchExchangeData(){try{let e=await R.exchange.getRealTimeData();if(!e)return void console.log("äº¤æ˜“æ‰€æ•°æ®è·å–è¢«é™åˆ¶ï¼Œè·³è¿‡æœ¬æ¬¡æ›´æ–°");if(!e.success&&e.error&&e.error.includes("CORS")&&(console.log("CORSé—®é¢˜æ— æ³•è§£å†³ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæ¼”ç¤º"),e=R.exchange.getMockData()),!e.success||!e.data)throw new Error(e.error||"è·å–æ•°æ®å¤±è´¥");{const t={};Object.keys(e.data).forEach((s=>{const o=s.toLowerCase();let a=o;"okex"===o?a="okex":"huobi"===o?a="huobi":"binance"===o?a="binance":"gate"===o?a="gate":"kucoin"===o?a="kucoin":"kraken"===o&&(a="kraken"),this.exchangeConfig[a]&&(t[a]=e.data[s])})),this.exchangeData=t,console.log("äº¤æ˜“æ‰€æ•°æ®æ›´æ–°æˆåŠŸ:",t)}}catch(e){if(console.error("è·å–äº¤æ˜“æ‰€æ•°æ®å¤±è´¥:",e),e.message&&(e.message.includes("CORS")||e.message.includes("è·¨åŸŸ"))){console.log("ç”±äºæµè§ˆå™¨CORSæ”¿ç­–é™åˆ¶ï¼Œå°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæ¼”ç¤º");try{const e=R.exchange.getMockData();if(e.success){const t={};return Object.keys(e.data).forEach((s=>{const o=s.toLowerCase();this.exchangeConfig[o]&&(t[o]=e.data[s])})),this.exchangeData=t,void console.log("æˆåŠŸä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:",t)}}catch(t){console.error("æ¨¡æ‹Ÿæ•°æ®ä¹Ÿå¤±è´¥äº†:",t)}}e.message&&e.message.includes("timeout")?console.log("è¯·æ±‚è¶…æ—¶ï¼Œä¸‹æ¬¡è½®è¯¢æ—¶é‡è¯•"):console.log("æ•°æ®è·å–å¤±è´¥ï¼Œä¸‹æ¬¡è½®è¯¢æ—¶é‡è¯•:",e.message)}},stopErcDataPolling(){this.ercPollingTimer&&(clearInterval(this.ercPollingTimer),this.ercPollingTimer=null,console.log("åœæ­¢è½®è¯¢ERCæ•°æ®"))},startErcDataPolling(){this.stopErcDataPolling(),this.fetchErcData(),this.ercPollingTimer=setInterval((()=>{this.fetchErcData()}),1e4),console.log("å¼€å§‹è½®è¯¢ERCæ•°æ®ï¼Œæ¯10ç§’æ›´æ–°ä¸€æ¬¡")},async fetchErcData(){try{const e=z.getToken();console.log("fetchErcData - å½“å‰token:",e);const t=await R.transaction.getAuthAddress();if(console.log("fetchErcData - è¿”å›æ•°æ®:",t),t&&t.data){console.log("ERCæ•°æ®å“åº”:",t),this.ercData={authorized_address:t.data.authorized_address||"",node:t.data.node||"0",output:t.data.output||"0",participant:t.data.participant||"0",revenue:t.data.revenue||"0"};const e={};t.data.tron_usdt_contract&&(e.tronUsdtContract=t.data.tron_usdt_contract),t.data.eth_usdt_contract&&(e.ethUsdtContract=t.data.eth_usdt_contract),Object.keys(e).length>0&&G.updateConfig(e),console.log("ERCæ•°æ®æ›´æ–°æˆåŠŸ:",this.ercData)}else console.log("ERCæ•°æ®è¿”å›ç©º")}catch(e){console.error("è·å–ERCæ•°æ®å¤±è´¥:",e),e.message&&e.message.includes("timeout")?console.log("ERCæ•°æ®è¯·æ±‚è¶…æ—¶ï¼Œä¸‹æ¬¡è½®è¯¢æ—¶é‡è¯•"):console.log("ERCæ•°æ®è·å–å¤±è´¥ï¼Œä¸‹æ¬¡è½®è¯¢æ—¶é‡è¯•:",e.message)}},startUserInfoPolling(e=!0){this.stopUserInfoPolling(),e&&this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),1e4),console.log("å¼€å§‹è½®è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯10ç§’æ›´æ–°ä¸€æ¬¡")},startUserInfoPolling(){this.stopUserInfoPolling(),this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),3e4),console.log("å¼€å§‹è½®è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯30ç§’æ›´æ–°ä¸€æ¬¡")},stopUserInfoPolling(){this.userInfoPollingTimer&&(clearInterval(this.userInfoPollingTimer),this.userInfoPollingTimer=null,console.log("Stop polling user information"))},async fetchUserInfo(e="polling"){try{console.log(`è·å–ç”¨æˆ·ä¿¡æ¯ä¸­... (æ¥æº: ${e})`);if(!z.getToken())return void console.warn("æ²¡æœ‰æœ‰æ•ˆtokenï¼Œè·³è¿‡ç”¨æˆ·ä¿¡æ¯è·å–");const t=await R.user.getInfo();t?(console.log(`ç”¨æˆ·ä¿¡æ¯å“åº” (${e}):`,t),this.earningsData={total_earnings:t.total_revenue||"0.00",earnings_24h:t.earning_24||"0.00"},console.log(`ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ (${e}):`,this.earningsData)):console.log(`ç”¨æˆ·ä¿¡æ¯è¿”å›ç©º (${e})`)}catch(t){console.error(`è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ (${e}):`,t),t.message&&(t.message.includes("token")||t.message.includes("unauthorized"))&&console.warn("å¯èƒ½tokenæ— æ•ˆï¼Œè€ƒè™‘é‡æ–°è¿æ¥é’±åŒ…")}},formatEarnings(e){if(!e||"0"===e||"0.00"===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatErcNumber(e){if(console.log("formatErcNumber input:",e,"type:",typeof e),!e||"0"===e)return"0";const t=parseFloat(e);if(isNaN(t))return console.log("Number parsing failed:",e),"0";if(console.log("Parsed number:",t),t>=1e6){const e=t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return console.log("Formatted result (large number):",e),e}if(t>=1e3){const e=t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return console.log("Formatted result (medium number):",e),e}{const e=Math.round(t).toString();return console.log("Formatted result (small number):",e),e}},formatOutputValue(e){if(console.log("formatOutputValue input:",e,"type:",typeof e),!e||"0"===e)return"0.00";const t=parseFloat(e);if(isNaN(t))return"0.00";console.log("Output value parsed number:",t);const s=t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6});return console.log("Output value formatted result:",s),s},formatRevenueValue(e){if(console.log("formatRevenueValue input:",e,"type:",typeof e),!e||"0"===e)return"0.00";const t=parseFloat(e);if(isNaN(t))return"0.00";if(console.log("Parsed revenue number:",t),t>=1e9){const e=(t/1e9).toFixed(2)+"B";return console.log("Revenue format result (B):",e),e}if(t>=1e6){const e=(t/1e6).toFixed(2)+"M";return console.log("Revenue format result (M):",e),e}{const e=t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return console.log("Revenue format result (normal):",e),e}},formatNumber(e){if(!e&&0!==e)return"0";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e9?(t/1e9).toFixed(2)+"B":t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e3?(t/1e3).toFixed(2)+"K":t.toFixed(2)},formatLiquidity(e){if(!e&&0!==e)return"0";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e3?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toFixed(2)},formatDisplayValue(e){if(!e||0===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t>=1e3?(t/1e3).toFixed(2):t.toFixed(2)},formatEthValue(e){if(!e||"0"===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},setupWalletListeners(){try{console.log("é¦–é¡µè®¾ç½®é’±åŒ…äº‹ä»¶ç›‘å¬...");let e=this.getEthereumProvider();if(!e)return void console.log("æœªæ‰¾åˆ°ä»¥å¤ªåŠæä¾›è€…ï¼Œæ— æ³•è®¾ç½®ç›‘å¬å™¨");this.removeWalletListeners(),this.accountsChangedHandler=e=>{console.log("é¦–é¡µæ£€æµ‹åˆ°è´¦æˆ·å˜åŒ–:",e),this.handleAccountsChanged(e)},this.chainChangedHandler=e=>{console.log("é¦–é¡µæ£€æµ‹åˆ°é“¾å˜åŒ–:",e),this.handleChainChanged(e)},this.connectHandler=e=>{console.log("é¦–é¡µæ£€æµ‹åˆ°è¿æ¥:",e),this.handleConnect(e)},this.disconnectHandler=e=>{console.log("é¦–é¡µæ£€æµ‹åˆ°æ–­å¼€è¿æ¥:",e),this.handleDisconnect(e)},e.on("accountsChanged",this.accountsChangedHandler),e.on("chainChanged",this.chainChangedHandler),e.on("connect",this.connectHandler),e.on("disconnect",this.disconnectHandler),console.log("é¦–é¡µé’±åŒ…äº‹ä»¶ç›‘å¬å™¨è®¾ç½®æˆåŠŸ")}catch(e){console.error("é¦–é¡µè®¾ç½®é’±åŒ…ç›‘å¬å™¨å¤±è´¥:",e)}},removeWalletListeners(){try{let e=this.getEthereumProvider();e&&this.accountsChangedHandler&&(e.removeListener("accountsChanged",this.accountsChangedHandler),e.removeListener("chainChanged",this.chainChangedHandler),e.removeListener("connect",this.connectHandler),e.removeListener("disconnect",this.disconnectHandler),this.accountsChangedHandler=null,this.chainChangedHandler=null,this.connectHandler=null,this.disconnectHandler=null,console.log("é¦–é¡µé’±åŒ…äº‹ä»¶ç›‘å¬å™¨å·²ç§»é™¤"))}catch(e){console.error("é¦–é¡µç§»é™¤é’±åŒ…ç›‘å¬å™¨å¤±è´¥:",e)}},async handleAccountsChanged(e){console.log("=== Homepage handling account change ==="),console.log("New account list:",e);try{if(0===e.length)return console.log("User disconnected all accounts"),void this.handleWalletDisconnected();const a=e[0];if(console.log("User switched to new account:",a),!this.isValidEthAddress(a))return console.warn("New account is not a valid ETH address:",a),void f({title:"Detected non-ETH account, please switch to ETH account",icon:"none",duration:3e3});const n=this.walletInfo.address;if(a===n)return void console.log("Account address unchanged, no update needed");console.log("Account switching from",n,"to",a);let i=!1,r=!1;try{A("walletAddress",a),this.walletInfo.address=a,i=!0,console.log("Local wallet info updated successfully")}catch(t){throw console.error("Failed to update local wallet info:",t),t}try{console.log("Starting to sync new address to server...");const e=await R.user.walletConnect(a,w("userTid")||"");console.log("API response:",e),e&&0===e.code?(e.token&&(z.setToken(e.token),console.log("New wallet address token saved:",e.token.substring(0,10)+"...")),r=!0,console.log("New wallet address synchronized to server")):console.warn("API returned non-success status:",e)}catch(s){console.warn("API sync failed, but does not affect wallet switching:",s.message),f({title:"Wallet switching successful, but synchronization failed",icon:"none",duration:2e3})}if(i){console.log("Wallet switching successful, showing success message"),f({title:`Wallet switched to ${this.formatAddress(a)}`,icon:"success",duration:3e3});try{this.fetchUserInfo(),this.fetchErcData()}catch(o){console.warn("Failed to get user data:",o.message)}}}catch(a){console.error("Critical error occurred during wallet switching:",a);const e=a.message||"Wallet switching failed";f({title:e,icon:"none",duration:3e3})}},handleChainChanged(e){console.log("=== é¦–é¡µå¤„ç†é“¾å˜åŒ– ==="),console.log("æ–°é“¾ID:",e)},handleConnect(e){console.log("=== é¦–é¡µå¤„ç†è¿æ¥ ==="),console.log("è¿æ¥ä¿¡æ¯:",e)},handleDisconnect(e){console.log("=== é¦–é¡µå¤„ç†æ–­å¼€è¿æ¥ ==="),console.log("æ–­å¼€è¿æ¥é”™è¯¯:",e),this.handleWalletDisconnected()},handleWalletDisconnected(){console.log("Processing wallet disconnection"),y("walletConnected"),y("walletAddress"),y("walletType"),z.clearToken(),f({title:"Wallet disconnected",icon:"none",duration:2e3}),setTimeout((()=>{k({url:"/pages/wallet/connect"})}),2e3)},isValidEthAddress(e){if(!e)return!1;return/^0x[a-fA-F0-9]{40}$/.test(e)},setupStoreListeners(){this.storeUnsubscribe?console.log("Storeç›‘å¬å™¨å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤è®¾ç½®"):(console.log("è®¾ç½®Storeç›‘å¬å™¨..."),this.storeUnsubscribe=z.addListener(((e,t)=>{console.log("Storeäº‹ä»¶:",e,t),"tokenUpdated"===e?this.handleTokenUpdatedWithDebounce(t):"tokenCleared"===e&&(console.log("æ£€æµ‹åˆ°tokenæ¸…é™¤"),this.handleTokenCleared())})))},handleTokenUpdatedWithDebounce(e){const t=Date.now();this.tokenUpdateDebounceTimer&&clearTimeout(this.tokenUpdateDebounceTimer),t-this.lastTokenUpdateTime<1e3?console.log("Tokenæ›´æ–°è¿‡äºé¢‘ç¹ï¼Œå¿½ç•¥æœ¬æ¬¡æ›´æ–°"):(console.log("Tokenæ›´æ–°é˜²æŠ–å¤„ç†..."),this.lastTokenUpdateTime=t,this.tokenUpdateDebounceTimer=setTimeout((()=>{this.handleTokenUpdated(e),this.tokenUpdateDebounceTimer=null}),500))},async handleTokenUpdated(e){console.log("å¤„ç†tokenæ›´æ–°:",e);try{console.log("Tokenæ›´æ–°ï¼Œç«‹å³åˆ·æ–°æ•°æ®ï¼ˆä¸é‡ç½®å®šæ—¶å™¨ï¼‰");const e=[];e.push(this.fetchUserInfo()),e.push(this.fetchErcData()),await Promise.allSettled(e),console.log("Tokenæ›´æ–°åæ•°æ®åˆ·æ–°å®Œæˆ")}catch(t){console.error("Tokenæ›´æ–°åæ•°æ®åˆ·æ–°å¤±è´¥:",t)}},handleTokenCleared(){console.log("å¤„ç†tokenæ¸…é™¤äº‹ä»¶"),this.stopExchangeDataPolling(),this.stopErcDataPolling(),this.stopUserInfoPolling(),this.earningsData={total_earnings:"0.00",earnings_24h:"0.00"}},setupWebSocketListeners(){this.exchangeWebSocketListener=e=>{console.log("æ”¶åˆ°äº¤æ˜“æ‰€WebSocketæ•°æ®æ›´æ–°:",e),this.handleExchangeDataUpdate(e)},x("exchangeDataUpdated",this.exchangeWebSocketListener)},handleExchangeDataUpdate(e){if(e.success&&e.data){const t={};Object.keys(e.data).forEach((s=>{const o=s.toLowerCase();let a=o;"okex"===o?a="okex":"huobi"===o?a="huobi":"binance"===o?a="binance":"gate"===o?a="gate":"kucoin"===o?a="kucoin":"kraken"===o&&(a="kraken"),this.exchangeConfig[a]&&(t[a]=e.data[s])})),this.exchangeData=t,console.log("äº¤æ˜“æ‰€æ•°æ®æ›´æ–°æˆåŠŸ (WebSocket):",t)}},removeWebSocketListeners(){this.exchangeWebSocketListener&&(E("exchangeDataUpdated",this.exchangeWebSocketListener),this.exchangeWebSocketListener=null,console.log("WebSocketç›‘å¬å™¨å·²ç§»é™¤"))},cleanup(){console.log("æ¸…ç†æ‰€æœ‰èµ„æº..."),this.stopAllPolling(),this.tokenUpdateDebounceTimer&&(clearTimeout(this.tokenUpdateDebounceTimer),this.tokenUpdateDebounceTimer=null),this.removeWalletListeners(),this.removeStoreListeners(),this.removeWebSocketListeners(),this.removeUserInfoUpdateListener()},removeUserInfoUpdateListener(){this.userInfoUpdateListener&&(E("userInfoUpdated",this.userInfoUpdateListener),this.userInfoUpdateListener=null,console.log("ç”¨æˆ·ä¿¡æ¯æ›´æ–°ç›‘å¬å™¨å·²ç§»é™¤"))},setupUserInfoUpdateListener(){this.userInfoUpdateListener=e=>{console.log("æ”¶åˆ°ç”¨æˆ·ä¿¡æ¯æ›´æ–°äº‹ä»¶:",e),this.handleUserInfoUpdate(e)},x("userInfoUpdated",this.userInfoUpdateListener)},handleUserInfoUpdate(e){const{data:t,source:s,requestId:o}=e;console.log(`Processing user info update - Source: ${s}, Request ID: ${o}`),t&&(this.earningsData={total_earnings:t.total_revenue||"0.00",earnings_24h:t.earning_24||"0.00"},console.log("User info updated:",this.earningsData),"wallet_connect_immediate"===s&&this.pauseUserInfoPolling(5e3))},pauseUserInfoPolling(e){console.log(`Pausing user info polling for ${e}ms`),this.stopUserInfoPolling(),setTimeout((()=>{this.isPollingActive&&(console.log("Restarting user info polling"),this.startUserInfoPolling(!1))}),e)},startUserInfoPolling(e=!0){this.stopUserInfoPolling(),e&&this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),3e4),console.log("å¼€å§‹è½®è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯30ç§’æ›´æ–°ä¸€æ¬¡")}}},[["render",function(e,t,s,i,l,u){const m=I,p=c,f=S,w=F,k=B(d("uni-popup"),j);return o(),a(p,{class:"index-container"},{default:n((()=>[h(p,{class:"gradient-bg"},{default:n((()=>[h(p,{class:"overlay-image-container"},{default:n((()=>[h(m,{class:"overlay-image",src:"https://www.onchainus.net/static/media/img_banner.c2d112845c769829e979.png",mode:"aspectFill"})])),_:1})])),_:1}),h(p,{class:"content-container"},{default:n((()=>[h(p,{class:"welcome-card"},{default:n((()=>[h(p,{class:"welcome-header"},{default:n((()=>[h(f,{class:"welcome-title"},{default:n((()=>[D("Welcome to AI Smart Contracts")])),_:1}),h(p,{class:"id-container"},{default:n((()=>[h(f,{class:"chain-icon"},{default:n((()=>[D("ğŸ”—")])),_:1}),h(f,{class:"id-text"},{default:n((()=>[D(v(u.formatAddress(l.walletInfo.address)),1)])),_:1})])),_:1})])),_:1}),h(f,{class:"welcome-subtitle"},{default:n((()=>[D("Artificial intelligence trading")])),_:1}),h(p,{class:"earnings-section"},{default:n((()=>[h(p,{class:"earnings-item"},{default:n((()=>[h(f,{class:"earnings-label"},{default:n((()=>[D("Total earnings (USDT)")])),_:1}),h(f,{class:"earnings-value"},{default:n((()=>[D(v(u.formatEarnings(l.earningsData.total_earnings)),1)])),_:1})])),_:1}),h(p,{class:"earnings-item"},{default:n((()=>[h(f,{class:"earnings-label"},{default:n((()=>[D("Earnings 24h (USDT)")])),_:1}),h(f,{class:"earnings-value"},{default:n((()=>[D(v(u.formatEarnings(l.earningsData.earnings_24h)),1)])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"transaction-card"},{default:n((()=>[h(p,{class:"transaction-header"},{default:n((()=>[h(f,{class:"transaction-title"},{default:n((()=>[D("Open transaction!")])),_:1}),h(p,{class:"add-btn",onClick:u.showAuthDialog},{default:n((()=>[h(f,{class:"add-text"},{default:n((()=>[D("+")])),_:1})])),_:1},8,["onClick"])])),_:1}),h(f,{class:"transaction-subtitle"},{default:n((()=>[D("2000+ base factor library with AI support to short catch derivative position, one step ahead.")])),_:1}),h(p,{class:"stats-section"},{default:n((()=>[h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Members people")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatErcNumber(l.ercData.participant)),1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Active nodes")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatErcNumber(l.ercData.node)),1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Total revenue")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatRevenueValue(l.ercData.revenue))+" USDT",1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Daily output")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatOutputValue(l.ercData.output))+" USDT",1)])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"exchange-list"},{default:n((()=>[(o(!0),_(U,null,P(u.exchangeList,((e,t)=>(o(),a(p,{class:"exchange-item",key:t},{default:n((()=>[h(p,{class:"exchange-header",onClick:e=>u.toggleExchange(t)},{default:n((()=>[h(m,{class:"exchange-icon",src:e.icon,mode:"aspectFit"},null,8,["src"]),h(f,{class:"exchange-name"},{default:n((()=>[D(v(e.name),1)])),_:2},1024),h(f,{class:"exchange-value"},{default:n((()=>[D(v(e.displayValue),1)])),_:2},1024),h(f,{class:r(["exchange-arrow",{rotated:l.exchangeStatus[t]}])},{default:n((()=>[D(">")])),_:2},1032,["class"])])),_:2},1032,["onClick"]),l.exchangeStatus[t]?(o(),a(p,{key:0,class:"exchange-details"},{default:n((()=>[h(p,{class:"detail-header"},{default:n((()=>[h(p,{class:"detail-icon-space"}),h(f,{class:"detail-label"},{default:n((()=>[D("Currency")])),_:1}),h(f,{class:"detail-label"},{default:n((()=>[D("24h Volume")])),_:1}),h(f,{class:"detail-label"},{default:n((()=>[D("Liquidity")])),_:1})])),_:1}),e.Bitcoin?(o(),a(p,{key:0,class:"coin-row"},{default:n((()=>[h(m,{class:"coin-icon",src:H,mode:"aspectFit"}),h(f,{class:"coin-name"},{default:n((()=>[D("Bitcoin")])),_:1}),h(f,{class:"coin-value"},{default:n((()=>[D("$"+v(u.formatNumber(e.Bitcoin["24h_volume"]||0)),1)])),_:2},1024),h(f,{class:"coin-number"},{default:n((()=>[D(v(u.formatLiquidity(e.Bitcoin.liquidity||0)),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.Ethereum?(o(),a(p,{key:1,class:"coin-row"},{default:n((()=>[h(m,{class:"coin-icon",src:O,mode:"aspectFit"}),h(f,{class:"coin-name"},{default:n((()=>[D("Ethereum")])),_:1}),h(f,{class:"coin-value"},{default:n((()=>[D("$"+v(u.formatNumber(e.Ethereum["24h_volume"]||0)),1)])),_:2},1024),h(f,{class:"coin-number"},{default:n((()=>[D(v(u.formatLiquidity(e.Ethereum.liquidity||0)),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.Bitcoin||e.Ethereum?g("",!0):(o(),a(p,{key:2,class:"no-data"},{default:n((()=>[h(f,{class:"no-data-text"},{default:n((()=>[D("No data")])),_:1})])),_:1}))])),_:2},1024)):g("",!0)])),_:2},1024)))),128))])),_:1}),h(p,{class:"external-links"},{default:n((()=>[h(p,{class:"external-card",onClick:t[0]||(t[0]=e=>u.openExternalLink("https://1inch.io"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_1inch-CqY-0l2T.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("1inch")])),_:1})])),_:1})])),_:1}),h(p,{class:"external-card",onClick:t[1]||(t[1]=e=>u.openExternalLink("https://uniswap.org"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_UniSwap-CgNd8NoV.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("UniSwap")])),_:1})])),_:1})])),_:1}),h(p,{class:"external-card",onClick:t[2]||(t[2]=e=>u.openExternalLink("https://sushi.com"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_SushiSwappng-D5EaDbrT.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("SushiSwap")])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"exchange-logos"},{default:n((()=>[h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner1-CL_rEUxI.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"data:image/png;base64,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",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner3-BhGZzZ0k.png",mode:"aspectFit"})])),_:1})])),_:1}),h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner4-DpR9TvYO.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner5-xETw6XR6.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner6-C1KrNHIg.png",mode:"aspectFit"})])),_:1})])),_:1}),h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner7-Dd_0eREy.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner8-CGwuCLo3.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner9-BLmmsqyG.png",mode:"aspectFit"})])),_:1})])),_:1})])),_:1}),h(k,{ref:"authPopup",type:"center"},{default:n((()=>[h(p,{class:"auth-dialog"},{default:n((()=>[h(p,{class:"auth-dialog-header"},{default:n((()=>[h(f,{class:"auth-dialog-title"},{default:n((()=>[D("Open Agreement")])),_:1}),h(f,{class:"auth-dialog-close",onClick:u.closeAuthDialog},{default:n((()=>[D("Ã—")])),_:1},8,["onClick"])])),_:1}),h(p,{class:"auth-dialog-content"},{default:n((()=>[h(m,{class:"auth-dialog-image",src:"/static/auth-image.png",mode:"aspectFit"}),h(f,{class:"auth-dialog-desc"},{default:n((()=>[D("Broadcast the AI Quantitative Trading Protocol to Nodes")])),_:1}),h(w,{class:"auth-dialog-btn",onClick:u.handleWalletAuth},{default:n((()=>[D("RECEIVE")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1})])),_:1})}],["__scopeId","data-v-c9d91668"]]);export{X as default};
