import{C as t,a,z as o,A as e,B as s,g as i,u as c,d as l,w as n,i as r,o as u,e as d,f as m,E as f,q as p,k as h,j as _,Q as g,I as A}from"./index-z45KPqVy.js";import{_ as D}from"./uni-icons.JJ4VBNMq.js";import{r as w}from"./uni-app.es.DChTL1Hf.js";import{a as y}from"./api.9jLx4H8a.js";import{_ as x,a as b,b as v,c as P}from"./icon14.BrQA54VK.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=C({data:()=>({productData:{},escrowAmount:"",maxAmount:125890}),computed:{isValidAmount(){console.log("=== isValidAmount 计算中 ==="),console.log("this.escrowAmount:",this.escrowAmount),console.log("this.productData:",this.productData);const t=parseFloat(this.escrowAmount);if(console.log("parsed amount:",t),!this.escrowAmount||isNaN(t)||t<=0)return console.log("返回 false - 输入无效"),!1;if(this.productData.amount){if(t<parseFloat(this.productData.amount))return console.log("返回 false - 小于最小金额"),!1}if(this.productData.limit_amount){if(t>parseFloat(this.productData.limit_amount))return console.log("返回 false - 超过最大金额"),!1}return console.log("返回 true - 验证通过"),!0}},onLoad(t){if(t.productData)try{this.productData=JSON.parse(decodeURIComponent(t.productData)),console.log("Get product data:",this.productData)}catch(a){console.error("Parse product data failed:",a),this.productData={}}},methods:{goBack(){t()},formatAmount(t){if(!t)return"0";const a=parseFloat(t);return a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()},setMaxAmount(){const t=Math.min(this.maxAmount,parseFloat(this.productData.limit_amount)||this.maxAmount);this.escrowAmount=t.toString()},validateAmount(){this.escrowAmount=this.escrowAmount.replace(/[^\d.]/g,"");const t=this.escrowAmount.split(".");t.length>2&&(this.escrowAmount=t[0]+"."+t[1]),console.log("输入后 escrowAmount:",this.escrowAmount),console.log("isValidAmount:",this.isValidAmount)},confirmPurchase(){if(!this.isValidAmount)return void a({title:"Please enter a valid amount",icon:"none"});const t=parseFloat(this.escrowAmount),o=parseFloat(this.productData.amount)||0,e=parseFloat(this.productData.limit_amount)||0;t<o?a({title:`Minimum investment amount is ${o} USDT`,icon:"none"}):t>e?a({title:`Maximum investment amount is ${e} USDT`,icon:"none"}):this.showConfirmDialog(t)},showConfirmDialog(t){const a=(.02*t).toFixed(2),e=(.02*t*parseInt(this.productData.days)).toFixed(2);o({title:"Confirm purchase",content:`Product: ${this.productData.title}\nInvestment amount: ${t} USDT\nEstimated daily income: ${a} USDT\nTotal expected income: ${e} USDT\nInvestment cycle: ${this.productData.days} days`,confirmText:"Confirm",cancelText:"Cancel",success:a=>{a.confirm&&this.processPurchase(t)}})},async processPurchase(o){e({title:"Processing..."});try{await this.callPurchaseAPI(o),s(),a({title:"Purchase successful",icon:"success",duration:2e3}),setTimeout((()=>{t()}),2e3)}catch(i){s(),a({title:i.message||"Purchase failed, please try again",icon:"none",duration:3e3})}},async callPurchaseAPI(t){try{const a=await y.pledge.createOrder(t,this.productData.id);return console.log("API 响应:",a),0===a.code?Promise.resolve(a):Promise.reject(new Error(a.info||"Purchase failed"))}catch(a){return Promise.reject(a)}},getUserId:()=>i("userId")||"",debugData(){console.log("=== 调试信息 ==="),console.log("escrowAmount:",this.escrowAmount),console.log("productData:",this.productData),console.log("isValidAmount:",this.isValidAmount)}}},[["render",function(t,a,o,e,s,i){const y=w(c("uni-icons"),D),C=r,F=h,I=_,k=g,V=A;return u(),l(C,{class:"buy-container"},{default:n((()=>[d(C,{class:"header-nav"},{default:n((()=>[d(C,{class:"nav-back",onClick:i.goBack},{default:n((()=>[d(y,{type:"left",size:"24",color:"#ffffff"})])),_:1},8,["onClick"])])),_:1}),d(C,{class:"main-title-section"},{default:n((()=>[d(F,{class:"page-title"},{default:n((()=>[m("Order Type")])),_:1}),d(F,{class:"page-subtitle"},{default:n((()=>[m("Intelligent protocol to profit back")])),_:1})])),_:1}),d(C,{class:"product-card"},{default:n((()=>[d(C,{class:"product-header"},{default:n((()=>[d(C,{class:"product-icon"},{default:n((()=>[d(F,{class:"icon-text"},{default:n((()=>[m(f(s.productData.title?s.productData.title.charAt(0):"M"),1)])),_:1})])),_:1}),d(C,{class:"product-info"},{default:n((()=>[d(F,{class:"product-name"},{default:n((()=>[m(f(s.productData.title||"Mobile AMM"),1)])),_:1}),d(C,{class:"rate-info"},{default:n((()=>[d(F,{class:"rate-label"},{default:n((()=>[m("Rate of return")])),_:1}),d(F,{class:"rate-value"},{default:n((()=>[m(f(s.productData.lixi_fanwei||"1.83-2.01%"),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(C,{class:"product-details"},{default:n((()=>[d(C,{class:"detail-row"},{default:n((()=>[d(C,{class:"detail-item"},{default:n((()=>[d(F,{class:"detail-label"},{default:n((()=>[m("limit(USDT)")])),_:1}),d(F,{class:"detail-value"},{default:n((()=>[m(f(i.formatAmount(s.productData.amount))+"-"+f(i.formatAmount(s.productData.limit_amount)),1)])),_:1})])),_:1}),d(C,{class:"detail-item"},{default:n((()=>[d(F,{class:"detail-label"},{default:n((()=>[m("Income")])),_:1}),d(F,{class:"detail-value"},{default:n((()=>[m("Every day")])),_:1})])),_:1}),d(C,{class:"detail-item"},{default:n((()=>[d(F,{class:"detail-label"},{default:n((()=>[m("Cycle")])),_:1}),d(F,{class:"detail-value"},{default:n((()=>[m(f(s.productData.days)+"Day",1)])),_:1})])),_:1})])),_:1}),d(C,{class:"social-icons"},{default:n((()=>[d(C,{class:"social-icon facebook"},{default:n((()=>[d(I,{class:"icon-image",src:x,mode:"aspectFit"})])),_:1}),d(C,{class:"social-icon twitter"},{default:n((()=>[d(I,{class:"icon-image",src:b,mode:"aspectFit"})])),_:1}),d(C,{class:"social-icon github"},{default:n((()=>[d(I,{class:"icon-image",src:v,mode:"aspectFit"})])),_:1}),d(C,{class:"social-icon telegram"},{default:n((()=>[d(I,{class:"icon-image",src:P,mode:"aspectFit"})])),_:1})])),_:1})])),_:1})])),_:1}),d(C,{class:"escrow-section"},{default:n((()=>[d(F,{class:"escrow-title"},{default:n((()=>[m("Escrow amount")])),_:1}),d(C,{class:"amount-input-container"},{default:n((()=>[d(k,{class:"amount-input",modelValue:s.escrowAmount,"onUpdate:modelValue":a[0]||(a[0]=t=>s.escrowAmount=t),placeholder:"0.00",type:"digit",onInput:i.validateAmount},null,8,["modelValue","onInput"]),d(C,{class:"max-button",onClick:i.setMaxAmount},{default:n((()=>[d(F,{class:"max-text"},{default:n((()=>[m("MAX")])),_:1})])),_:1},8,["onClick"])])),_:1}),d(F,{class:"escrow-description"},{default:n((()=>[m(" Support hundreds of transactions to run trading strategies at the same time, each variety has an independent thread, automatically monitor quotation depth, strategy calculation, real-time monitoring of transaction conditions, and ensure the immediacy of transaction execution. ")])),_:1})])),_:1}),d(C,{class:"confirm-button-section"},{default:n((()=>[d(V,{class:p(["confirm-button",{disabled:!i.isValidAmount}]),onClick:i.confirmPurchase,disabled:!i.isValidAmount},{default:n((()=>[m(" Confirm ")])),_:1},8,["class","onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-429510b3"]]);export{F as default};
