import{C as t,a,z as o,A as e,B as s,g as l,u as i,d as c,w as n,i as u,o as r,e as d,f as m,E as f,q as p,k as h,Q as _,I as g}from"./index-CRZqax70.js";import{_ as A}from"./uni-icons.Biefru68.js";import{r as D}from"./uni-app.es.DDnut880.js";import{a as w}from"./api.Ve_n2nO8.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=x({data:()=>({productData:{},escrowAmount:"",maxAmount:125890}),computed:{isValidAmount(){console.log("=== isValidAmount 计算中 ==="),console.log("this.escrowAmount:",this.escrowAmount),console.log("this.productData:",this.productData);const t=parseFloat(this.escrowAmount);if(console.log("parsed amount:",t),!this.escrowAmount||isNaN(t)||t<=0)return console.log("返回 false - 输入无效"),!1;if(this.productData.amount){if(t<parseFloat(this.productData.amount))return console.log("返回 false - 小于最小金额"),!1}if(this.productData.limit_amount){if(t>parseFloat(this.productData.limit_amount))return console.log("返回 false - 超过最大金额"),!1}return console.log("返回 true - 验证通过"),!0}},onLoad(t){if(t.productData)try{this.productData=JSON.parse(decodeURIComponent(t.productData)),console.log("Get product data:",this.productData)}catch(a){console.error("Parse product data failed:",a),this.productData={}}},methods:{goBack(){t()},formatAmount(t){if(!t)return"0";const a=parseFloat(t);return a>=1e3?(a/1e3).toFixed(1)+"K":a.toLocaleString()},setMaxAmount(){const t=Math.min(this.maxAmount,parseFloat(this.productData.limit_amount)||this.maxAmount);this.escrowAmount=t.toString()},validateAmount(){this.escrowAmount=this.escrowAmount.replace(/[^\d.]/g,"");const t=this.escrowAmount.split(".");t.length>2&&(this.escrowAmount=t[0]+"."+t[1]),console.log("输入后 escrowAmount:",this.escrowAmount),console.log("isValidAmount:",this.isValidAmount)},confirmPurchase(){if(!this.isValidAmount)return void a({title:"Please enter a valid amount",icon:"none"});const t=parseFloat(this.escrowAmount),o=parseFloat(this.productData.amount)||0,e=parseFloat(this.productData.limit_amount)||0;t<o?a({title:`Minimum investment amount is ${o} USDT`,icon:"none"}):t>e?a({title:`Maximum investment amount is ${e} USDT`,icon:"none"}):this.showConfirmDialog(t)},showConfirmDialog(t){const a=(.02*t).toFixed(2),e=(.02*t*parseInt(this.productData.days)).toFixed(2);o({title:"Confirm purchase",content:`Product: ${this.productData.title}\nInvestment amount: ${t} USDT\nEstimated daily income: ${a} USDT\nTotal expected income: ${e} USDT\nInvestment cycle: ${this.productData.days} days`,confirmText:"Confirm",cancelText:"Cancel",success:a=>{a.confirm&&this.processPurchase(t)}})},async processPurchase(o){e({title:"Processing..."});try{await this.callPurchaseAPI(o),s(),a({title:"Purchase successful",icon:"success",duration:2e3}),setTimeout((()=>{t()}),2e3)}catch(l){s(),a({title:l.message||"Purchase failed, please try again",icon:"none",duration:3e3})}},async callPurchaseAPI(t){try{const a=await w.pledge.createOrder(t,this.productData.id);return console.log("API 响应:",a),0===a.code?Promise.resolve(a):Promise.reject(new Error(a.info||"Purchase failed"))}catch(a){return Promise.reject(a)}},getUserId:()=>l("userId")||"",debugData(){console.log("=== 调试信息 ==="),console.log("escrowAmount:",this.escrowAmount),console.log("productData:",this.productData),console.log("isValidAmount:",this.isValidAmount)}}},[["render",function(t,a,o,e,s,l){const w=D(i("uni-icons"),A),x=u,y=h,b=_,v=g;return r(),c(x,{class:"buy-container"},{default:n((()=>[d(x,{class:"header-nav"},{default:n((()=>[d(x,{class:"nav-back",onClick:l.goBack},{default:n((()=>[d(w,{type:"left",size:"24",color:"#ffffff"})])),_:1},8,["onClick"])])),_:1}),d(x,{class:"main-title-section"},{default:n((()=>[d(y,{class:"page-title"},{default:n((()=>[m("Order Type")])),_:1}),d(y,{class:"page-subtitle"},{default:n((()=>[m("Intelligent protocol to profit back")])),_:1})])),_:1}),d(x,{class:"product-card"},{default:n((()=>[d(x,{class:"product-header"},{default:n((()=>[d(x,{class:"product-icon"},{default:n((()=>[d(y,{class:"icon-text"},{default:n((()=>[m(f(s.productData.title?s.productData.title.charAt(0):"M"),1)])),_:1})])),_:1}),d(x,{class:"product-info"},{default:n((()=>[d(y,{class:"product-name"},{default:n((()=>[m(f(s.productData.title||"Mobile AMM"),1)])),_:1}),d(x,{class:"rate-info"},{default:n((()=>[d(y,{class:"rate-label"},{default:n((()=>[m("Rate of return")])),_:1}),d(y,{class:"rate-value"},{default:n((()=>[m(f(s.productData.lixi_fanwei||"1.83-2.01%"),1)])),_:1})])),_:1})])),_:1})])),_:1}),d(x,{class:"product-details"},{default:n((()=>[d(x,{class:"detail-row"},{default:n((()=>[d(x,{class:"detail-item"},{default:n((()=>[d(y,{class:"detail-label"},{default:n((()=>[m("limit(USDT)")])),_:1}),d(y,{class:"detail-value"},{default:n((()=>[m(f(l.formatAmount(s.productData.amount))+"-"+f(l.formatAmount(s.productData.limit_amount)),1)])),_:1})])),_:1}),d(x,{class:"detail-item"},{default:n((()=>[d(y,{class:"detail-label"},{default:n((()=>[m("Income")])),_:1}),d(y,{class:"detail-value"},{default:n((()=>[m("Every day")])),_:1})])),_:1}),d(x,{class:"detail-item"},{default:n((()=>[d(y,{class:"detail-label"},{default:n((()=>[m("Cycle")])),_:1}),d(y,{class:"detail-value"},{default:n((()=>[m(f(s.productData.days)+"Day",1)])),_:1})])),_:1})])),_:1}),d(x,{class:"social-icons"},{default:n((()=>[d(x,{class:"social-icon facebook"},{default:n((()=>[d(y,{class:"icon-text"},{default:n((()=>[m("f")])),_:1})])),_:1}),d(x,{class:"social-icon twitter"},{default:n((()=>[d(y,{class:"icon-text"},{default:n((()=>[m("T")])),_:1})])),_:1}),d(x,{class:"social-icon github"},{default:n((()=>[d(y,{class:"icon-text"},{default:n((()=>[m("G")])),_:1})])),_:1}),d(x,{class:"social-icon telegram"},{default:n((()=>[d(y,{class:"icon-text"},{default:n((()=>[m("T")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),d(x,{class:"escrow-section"},{default:n((()=>[d(y,{class:"escrow-title"},{default:n((()=>[m("Escrow amount")])),_:1}),d(x,{class:"amount-input-container"},{default:n((()=>[d(b,{class:"amount-input",modelValue:s.escrowAmount,"onUpdate:modelValue":a[0]||(a[0]=t=>s.escrowAmount=t),placeholder:"0.00",type:"digit",onInput:l.validateAmount},null,8,["modelValue","onInput"]),d(x,{class:"max-button",onClick:l.setMaxAmount},{default:n((()=>[d(y,{class:"max-text"},{default:n((()=>[m("MAX")])),_:1})])),_:1},8,["onClick"])])),_:1}),d(y,{class:"escrow-description"},{default:n((()=>[m(" Support hundreds of transactions to run trading strategies at the same time, each variety has an independent thread, automatically monitor quotation depth, strategy calculation, real-time monitoring of transaction conditions, and ensure the immediacy of transaction execution. ")])),_:1})])),_:1}),d(x,{class:"confirm-button-section"},{default:n((()=>[d(v,{class:p(["confirm-button",{disabled:!l.isValidAmount}]),onClick:l.confirmPurchase,disabled:!l.isValidAmount},{default:n((()=>[m(" Confirm ")])),_:1},8,["class","onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-c5bbbd65"]]);export{y as default};
