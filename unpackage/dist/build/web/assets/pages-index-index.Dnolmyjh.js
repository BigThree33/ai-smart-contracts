import{l as e,m as t,v as o,o as s,d as a,w as n,p as i,q as r,t as l,i as c,u as d,x as u,e as h,h as g,y as m,z as p,a as f,g as w,b as k,s as A,r as y,A as C,B as T,C as b,$ as x,D as E,f as D,E as v,F as _,G as P,H as U,j as I,k as S,I as F}from"./index-z45KPqVy.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as B}from"./uni-app.es.DChTL1Hf.js";import{a as z,s as R,b as H}from"./api.9jLx4H8a.js";import{_ as W}from"./btc.JZb5stum.js";import{_ as O}from"./eth.BkoDDH_E.js";class N{constructor(t,o){this.options=t,this.animation=e({...t}),this.currentStepAnimates={},this.next=0,this.$=o}_nvuePushAnimates(e,t){let o=this.currentStepAnimates[this.next],s={};if(s=o||{styles:{},config:{}},q.includes(e)){s.styles.transform||(s.styles.transform="");let o="";"rotate"===e&&(o="deg"),s.styles.transform+=`${e}(${t+o}) `}else s.styles[e]=`${t}`;this.currentStepAnimates[this.next]=s}_animateRun(e={},t={}){let o=this.$.$refs.ani.ref;if(o)return new Promise(((s,a)=>{nvueAnimation.transition(o,{styles:e,...t},(e=>{s()}))}))}_nvueNextAnimate(e,t=0,o){let s=e[t];if(s){let{styles:a,config:n}=s;this._animateRun(a,n).then((()=>{t+=1,this._nvueNextAnimate(e,t,o)}))}else this.currentStepAnimates={},"function"==typeof o&&o(),this.isEnd=!0}step(e={}){return this.animation.step(e),this}run(e){this.$.animationData=this.animation.export(),this.$.timer=setTimeout((()=>{"function"==typeof e&&e()}),this.$.durationTime)}}const q=["matrix","matrix3d","rotate","rotate3d","rotateX","rotateY","rotateZ","scale","scale3d","scaleX","scaleY","scaleZ","skew","skewX","skewY","translate","translate3d","translateX","translateY","translateZ"];function G(e,t){if(t)return clearTimeout(t.timer),new N(e,t)}q.concat(["opacity","backgroundColor"],["width","height","left","right","top","bottom"]).forEach((e=>{N.prototype[e]=function(...t){return this.animation[e](...t),this}}));const M=L({name:"uniTransition",emits:["click","change"],props:{show:{type:Boolean,default:!1},modeClass:{type:[Array,String],default:()=>"fade"},duration:{type:Number,default:300},styles:{type:Object,default:()=>({})},customClass:{type:String,default:""},onceRender:{type:Boolean,default:!1}},data:()=>({isShow:!1,transform:"",opacity:1,animationData:{},durationTime:300,config:{}}),watch:{show:{handler(e){e?this.open():this.isShow&&this.close()},immediate:!0}},computed:{stylesObject(){let e={...this.styles,"transition-duration":this.duration/1e3+"s"},t="";for(let o in e){t+=this.toLine(o)+":"+e[o]+";"}return t},transformStyles(){return"transform:"+this.transform+";opacity:"+this.opacity+";"+this.stylesObject}},created(){this.config={duration:this.duration,timingFunction:"ease",transformOrigin:"50% 50%",delay:0},this.durationTime=this.duration},methods:{init(e={}){e.duration&&(this.durationTime=e.duration),this.animation=G(Object.assign(this.config,e),this)},onClick(){this.$emit("click",{detail:this.isShow})},step(e,t={}){if(this.animation){for(let t in e)try{"object"==typeof e[t]?this.animation[t](...e[t]):this.animation[t](e[t])}catch(o){console.error(`方法 ${t} 不存在`)}return this.animation.step(t),this}},run(e){this.animation&&this.animation.run(e)},open(){clearTimeout(this.timer),this.transform="",this.isShow=!0;let{opacity:e,transform:t}=this.styleInit(!1);void 0!==e&&(this.opacity=e),this.transform=t,this.$nextTick((()=>{this.timer=setTimeout((()=>{this.animation=G(this.config,this),this.tranfromInit(!1).step(),this.animation.run(),this.$emit("change",{detail:this.isShow})}),20)}))},close(e){this.animation&&this.tranfromInit(!0).step().run((()=>{this.isShow=!1,this.animationData=null,this.animation=null;let{opacity:e,transform:t}=this.styleInit(!1);this.opacity=e||1,this.transform=t,this.$emit("change",{detail:this.isShow})}))},styleInit(e){let t={transform:""},o=(e,o)=>{"fade"===o?t.opacity=this.animationType(e)[o]:t.transform+=this.animationType(e)[o]+" "};return"string"==typeof this.modeClass?o(e,this.modeClass):this.modeClass.forEach((t=>{o(e,t)})),t},tranfromInit(e){let t=(e,t)=>{let o=null;"fade"===t?o=e?0:1:(o=e?"-100%":"0","zoom-in"===t&&(o=e?.8:1),"zoom-out"===t&&(o=e?1.2:1),"slide-right"===t&&(o=e?"100%":"0"),"slide-bottom"===t&&(o=e?"100%":"0")),this.animation[this.animationMode()[t]](o)};return"string"==typeof this.modeClass?t(e,this.modeClass):this.modeClass.forEach((o=>{t(e,o)})),this.animation},animationType:e=>({fade:e?0:1,"slide-top":`translateY(${e?"0":"-100%"})`,"slide-right":`translateX(${e?"0":"100%"})`,"slide-bottom":`translateY(${e?"0":"100%"})`,"slide-left":`translateX(${e?"0":"-100%"})`,"zoom-in":`scaleX(${e?1:.8}) scaleY(${e?1:.8})`,"zoom-out":`scaleX(${e?1:1.2}) scaleY(${e?1:1.2})`}),animationMode:()=>({fade:"opacity","slide-top":"translateY","slide-right":"translateX","slide-bottom":"translateY","slide-left":"translateX","zoom-in":"scale","zoom-out":"scale"}),toLine:e=>e.replace(/([A-Z])/g,"-$1").toLowerCase()}},[["render",function(e,d,u,h,g,m){const p=c;return t((s(),a(p,{ref:"ani",animation:g.animationData,class:r(u.customClass),style:l(m.transformStyles),onClick:m.onClick},{default:n((()=>[i(e.$slots,"default")])),_:3},8,["animation","class","style","onClick"])),[[o,g.isShow]])}]]);const j=L({name:"uniPopup",components:{keypress:{name:"Keypress",props:{disable:{type:Boolean,default:!1}},mounted(){const e={esc:["Esc","Escape"],tab:"Tab",enter:"Enter",space:[" ","Spacebar"],up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete","Del"]};document.addEventListener("keyup",(t=>{if(this.disable)return;const o=Object.keys(e).find((o=>{const s=t.key,a=e[o];return a===s||Array.isArray(a)&&a.includes(s)}));o&&setTimeout((()=>{this.$emit(o,{})}),0)}))},render:()=>{}}},emits:["change","maskClick"],props:{animation:{type:Boolean,default:!0},type:{type:String,default:"center"},isMaskClick:{type:Boolean,default:null},maskClick:{type:Boolean,default:null},backgroundColor:{type:String,default:"none"},safeArea:{type:Boolean,default:!0},maskBackgroundColor:{type:String,default:"rgba(0, 0, 0, 0.4)"},borderRadius:{type:String}},watch:{type:{handler:function(e){this.config[e]&&this[this.config[e]](!0)},immediate:!0},isDesktop:{handler:function(e){this.config[e]&&this[this.config[this.type]](!0)},immediate:!0},maskClick:{handler:function(e){this.mkclick=e},immediate:!0},isMaskClick:{handler:function(e){this.mkclick=e},immediate:!0},showPopup(e){document.getElementsByTagName("body")[0].style.overflow=e?"hidden":"visible"}},data(){return{duration:300,ani:[],showPopup:!1,showTrans:!1,popupWidth:0,popupHeight:0,config:{top:"top",bottom:"bottom",center:"center",left:"left",right:"right",message:"top",dialog:"center",share:"bottom"},maskClass:{position:"fixed",bottom:0,top:0,left:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)"},transClass:{backgroundColor:"transparent",borderRadius:this.borderRadius||"0",position:"fixed",left:0,right:0},maskShow:!0,mkclick:!0,popupstyle:"top"}},computed:{getStyles(){let e={backgroundColor:this.bg};return this.borderRadius,e=Object.assign(e,{borderRadius:this.borderRadius}),e},isDesktop(){return this.popupWidth>=500&&this.popupHeight>=500},bg(){return""===this.backgroundColor||"none"===this.backgroundColor?"transparent":this.backgroundColor}},mounted(){(()=>{const{windowWidth:e,windowHeight:t,windowTop:o,safeArea:s,screenHeight:a,safeAreaInsets:n}=m();this.popupWidth=e,this.popupHeight=t+(o||0),s&&this.safeArea?this.safeAreaInsets=n.bottom:this.safeAreaInsets=0})()},unmounted(){this.setH5Visible()},activated(){this.setH5Visible(!this.showPopup)},deactivated(){this.setH5Visible(!0)},created(){null===this.isMaskClick&&null===this.maskClick?this.mkclick=!0:this.mkclick=null!==this.isMaskClick?this.isMaskClick:this.maskClick,this.animation?this.duration=300:this.duration=0,this.messageChild=null,this.clearPropagation=!1,this.maskClass.backgroundColor=this.maskBackgroundColor},methods:{setH5Visible(e=!0){document.getElementsByTagName("body")[0].style.overflow=e?"visible":"hidden"},closeMask(){this.maskShow=!1},disableMask(){this.mkclick=!1},clear(e){e.stopPropagation(),this.clearPropagation=!0},open(e){if(this.showPopup)return;e&&-1!==["top","center","bottom","left","right","message","dialog","share"].indexOf(e)||(e=this.type),this.config[e]?(this[this.config[e]](),this.$emit("change",{show:!0,type:e})):console.error("缺少类型：",e)},close(e){this.showTrans=!1,this.$emit("change",{show:!1,type:this.type}),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showPopup=!1}),300)},touchstart(){this.clearPropagation=!1},onTap(){this.clearPropagation?this.clearPropagation=!1:(this.$emit("maskClick"),this.mkclick&&this.close())},top(e){this.popupstyle=this.isDesktop?"fixforpc-top":"top",this.ani=["slide-top"],this.transClass={position:"fixed",left:0,right:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0,this.$nextTick((()=>{this.messageChild&&"message"===this.type&&this.messageChild.timerClose()})))},bottom(e){this.popupstyle="bottom",this.ani=["slide-bottom"],this.transClass={position:"fixed",left:0,right:0,bottom:0,paddingBottom:this.safeAreaInsets+"px",backgroundColor:this.bg,borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},center(e){this.popupstyle="center",this.ani=["zoom-out","fade"],this.transClass={position:"fixed",display:"flex",flexDirection:"column",bottom:0,left:0,right:0,top:0,justifyContent:"center",alignItems:"center",borderRadius:this.borderRadius||"0"},e||(this.showPopup=!0,this.showTrans=!0)},left(e){this.popupstyle="left",this.ani=["slide-left"],this.transClass={position:"fixed",left:0,bottom:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)},right(e){this.popupstyle="right",this.ani=["slide-right"],this.transClass={position:"fixed",bottom:0,right:0,top:0,backgroundColor:this.bg,borderRadius:this.borderRadius||"0",display:"flex",flexDirection:"column"},e||(this.showPopup=!0,this.showTrans=!0)}}},[["render",function(e,t,o,m,p,f){const w=B(d("uni-transition"),M),k=c,A=u("keypress");return p.showPopup?(s(),a(k,{key:0,class:r(["uni-popup",[p.popupstyle,f.isDesktop?"fixforpc-z-index":""]])},{default:n((()=>[h(k,{onTouchstart:f.touchstart},{default:n((()=>[p.maskShow?(s(),a(w,{key:"1",name:"mask","mode-class":"fade",styles:p.maskClass,duration:p.duration,show:p.showTrans,onClick:f.onTap},null,8,["styles","duration","show","onClick"])):g("",!0),h(w,{key:"2","mode-class":p.ani,name:"content",styles:p.transClass,duration:p.duration,show:p.showTrans,onClick:f.onTap},{default:n((()=>[h(k,{class:r(["uni-popup__wrapper",[p.popupstyle]]),style:l(f.getStyles),onClick:f.clear},{default:n((()=>[i(e.$slots,"default",{},void 0,!0)])),_:3},8,["style","class","onClick"])])),_:3},8,["mode-class","styles","duration","show","onClick"])])),_:3},8,["onTouchstart"]),p.maskShow?(s(),a(A,{key:0,onEsc:f.onTap},null,8,["onEsc"])):g("",!0)])),_:3},8,["class"])):g("",!0)}],["__scopeId","data-v-f0b957f8"]]);const V=new class{constructor(e={}){this.config={tronUsdtContract:"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t",ethUsdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7",defaultApproveAmount:"1000000",defaultGas:"0x11170",defaultGasPrice:"0x3B9ACA00",maxGasPrice:"0x4A817C800",defaultFeeLimit:1e6,...e}}detectTokenPocketEnvironment(){var e;if("undefined"==typeof window)return!1;const t=window.tokenpocket,o=window.ethereum&&(window.ethereum.isTokenPocket||window.ethereum.isTP||(null==(e=window.ethereum.providers)?void 0:e.some((e=>e.isTokenPocket||e.isTP)))),s=navigator.userAgent.includes("TokenPocket"),a=window.tronWeb&&window.tronWeb.isTokenPocket;return t||o||s||a}async openTokenPocketApp(e){try{const t=`tpoutside://dapp/open?dappUrl=${encodeURIComponent(e)}`,o=document.createElement("a");o.href=t,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout((()=>{p({title:"Notice",content:"If it did not automatically jump to TokenPocket, please manually open this page in TokenPocket",showCancel:!0,confirmText:"Copy Link",success:t=>{t.confirm&&this.copyToClipboard(e)}})}),1e3)}catch(t){throw console.error("拉起TokenPocket失败:",t),new Error("Unable to launch TokenPocket app")}}async requestAuth(e,t=null){try{const o=await this.requestTronAuth(e,t);if(o.success)return{success:!0,type:"TRON",address:o.address,txHash:o.txHash};const s=await this.requestEthereumAuth(e,t);return s.success?{success:!0,type:"ETHEREUM",address:s.address,txHash:s.txHash}:{success:!1,message:"No available wallet connection found"}}catch(o){return console.error("TokenPocket授权请求失败:",o),{success:!1,message:o.message||"Authorization request failed"}}}async requestTronAuth(e,t=null){try{let o=null;if(window.tokenpocket&&window.tokenpocket.tron?o=window.tokenpocket.tron:window.tronWeb?o=window.tronWeb:window.tronLink&&window.tronLink.tronWeb&&(o=window.tronLink.tronWeb),!o)return{success:!1,message:"Tron wallet not detected"};let s=null;if(o.defaultAddress&&o.defaultAddress.base58)s=o.defaultAddress.base58;else{const e=await o.request({method:"tron_requestAccounts"});e&&e.length>0&&(s=e[0])}if(!s)return{success:!1,message:"Tron wallet connection failed"};const a=t||this.config.defaultApproveAmount,n=await o.contract().at(this.config.tronUsdtContract);return{success:!0,address:s,txHash:await n.approve(e,a).send({from:s,feeLimit:this.config.defaultFeeLimit})}}catch(o){return console.error("Tron授权失败:",o),o.message.includes("User rejected")?{success:!1,message:"User rejected authorization"}:{success:!1,message:"Tron authorization transaction failed"}}}async requestEthereumAuth(e,t=null){try{let o=null;if(window.tokenpocket&&window.tokenpocket.ethereum?o=window.tokenpocket.ethereum:window.ethereum&&(o=window.ethereum),!o)return{success:!1,message:"Ethereum wallet not detected"};const s=await o.request({method:"eth_requestAccounts"});if(!s||0===s.length)return{success:!1,message:"Ethereum wallet connection failed"};const a=s[0],n=t?this.toHex(t):"0x9c2007651b2500000",i="0x095ea7b3"+e.slice(2).padStart(64,"0")+n.slice(2).padStart(64,"0");return{success:!0,address:a,txHash:await o.request({method:"eth_sendTransaction",params:[{from:a,to:this.config.ethUsdtContract,data:i,gas:this.config.defaultGas,gasPrice:this.config.defaultGasPrice}]})}}catch(o){return console.error("以太坊授权失败:",o),o.message.includes("User rejected")?{success:!1,message:"User rejected authorization"}:{success:!1,message:"Ethereum authorization transaction failed"}}}copyToClipboard(e){navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>{f({title:"Link copied",icon:"success"})}))}toHex(e){return"string"==typeof e&&e.startsWith("0x")?e:"0x"+parseInt(e).toString(16)}formatAddress(e){return!e||e.length<=10?e:`${e.substring(0,6)}...${e.substring(e.length-4)}`}formatTxHash(e){return!e||e.length<=10?e:`${e.substring(0,8)}...${e.substring(e.length-6)}`}getCurrentUrl(){return window.location.href}updateConfig(e={}){this.config={tronUsdtContract:"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t",ethUsdtContract:"0xdAC17F958D2ee523a2206206994597C13D831ec7",defaultApproveAmount:"1000000",defaultGas:"0x11170",defaultGasPrice:"0x3B9ACA00",maxGasPrice:"0x4A817C800",defaultFeeLimit:1e6,...e},console.log("TokenPocketAuth配置已更新:",{tronUsdtContract:this.config.tronUsdtContract,ethUsdtContract:this.config.ethUsdtContract})}};const J=L({data:()=>({exchangeStatus:{binance:!0,huobi:!1,gate:!1,okex:!1,kucoin:!1,kraken:!1},walletInfo:{connected:!1,type:"",address:""},authAddress:"",earningsData:{total_earnings:"0.00",earnings_24h:"0.00"},exchangeData:{},pollingTimer:null,exchangeConfig:{binance:{name:"Binance",icon:"/static/binance.png"},huobi:{name:"Huobi",icon:"/static/huobi.png"},gate:{name:"Gate",icon:"/static/gate.png"},okex:{name:"OKEx",icon:"/static/okex.png"},kucoin:{name:"KuCoin",icon:"/static/kucoin.png"},kraken:{name:"Kraken",icon:"/static/kraken.png"}},ercData:{authorized_address:"",node:"0",output:"0",participant:"0",revenue:"0"},ercPollingTimer:null,userInfoPollingTimer:null,accountsChangedHandler:null,chainChangedHandler:null,connectHandler:null,disconnectHandler:null,tokenUpdateDebounceTimer:null,isPollingActive:!1,lastTokenUpdateTime:0,storeUnsubscribe:null,userInfoUpdateListener:null}),computed:{exchangeList(){const e={};return Object.keys(this.exchangeConfig).forEach((t=>{const o=this.exchangeConfig[t],s=this.exchangeData[t]||{};let a="0.00";s.Bitcoin&&s.Bitcoin.eth?a=this.formatEthValue(s.Bitcoin.eth):s.Ethereum&&s.Ethereum.eth&&(a=this.formatEthValue(s.Ethereum.eth)),e[t]={...o,...s,displayValue:a}})),e}},onLoad(){console.log("=== 页面加载 ==="),this.checkWalletConnection(),this.setupWalletListeners(),this.setupStoreListeners(),this.setupUserInfoUpdateListener(),this.startAllPolling()},onShow(){console.log("=== 页面显示 ==="),this.checkWalletConnection(),this.accountsChangedHandler||this.setupWalletListeners(),this.storeUnsubscribe||this.setupStoreListeners(),this.userInfoUpdateListener||this.setupUserInfoUpdateListener(),this.isPollingActive||(console.log("轮询未活跃，重新启动"),this.startAllPolling())},onHide(){console.log("=== 页面隐藏 ==="),this.stopAllPolling(),this.removeWalletListeners()},onUnload(){console.log("=== 页面卸载 ==="),this.cleanup()},methods:{async checkWalletConnection(){const e=w("walletAddress"),t=w("walletType");if(e)try{console.log("=== 调用wallet_connect接口 ==="),console.log("钱包地址:",e);const o=await z.user.walletConnect(e,w("userTid")||"");if(console.log("wallet_connect响应:",o),!o||0!==o.code)throw new Error(o.info||"Wallet connection failed");o.token&&(R.setToken(o.token),console.log("Token已保存到store:",o.token)),A("walletConnected",!0),this.walletInfo={connected:!0,type:t||"Auto-detected",address:e},console.log("钱包连接成功")}catch(o){console.error("wallet_connect调用失败:",o),y("walletConnected"),y("walletAddress"),y("walletType"),R.clearToken(),f({title:"Wallet connection failed, please reconnect",icon:"none",duration:2e3}),setTimeout((()=>{k({url:"/pages/wallet/connect"})}),2e3)}else k({url:"/pages/wallet/connect"})},formatAddress:e=>e?e.length<=10?e:`${e.substring(0,6)}...${e.substring(e.length-4)}`:"",disconnectWallet(){console.log("=== Disconnect wallet ==="),console.log("Before disconnecting store token:",R.getToken()),console.log("Before disconnecting local storage token:",{userToken:w("userToken"),token:w("token")}),p({title:"Disconnect",content:"Are you sure you want to disconnect the wallet?",success:e=>{e.confirm&&(y("walletConnected"),y("walletAddress"),y("walletType"),y("connectTime"),R.clearToken(),y("token"),console.log("After disconnecting store token:",R.getToken()),console.log("After disconnecting local storage token:",{userToken:w("userToken"),token:w("token")}),k({url:"/pages/wallet/connect"}))}})},toggleExchange(e){this.exchangeStatus[e]=!this.exchangeStatus[e]},openExternalLink(e){window.open(e,"_blank")},async showAuthDialog(){try{if(C({title:"Getting authorization info..."}),await this.getAuthAddress(),T(),!this.authAddress)return void f({title:"Failed to get authorization address, please try again",icon:"none",duration:2e3});this.$refs.authPopup.open()}catch(e){T(),console.error("显示授权弹窗失败:",e),f({title:"Failed to get authorization info",icon:"none",duration:2e3})}},closeAuthDialog(){this.$refs.authPopup.close()},async getAuthAddress(){try{const e=R.getToken();console.log("getAuthAddress - 当前token:",e);const t=await z.transaction.getAuthAddress();if(console.log("getAuthAddress - 返回数据:",t),t&&t.data){if(!t.data.authorized_address)throw new Error("API did not return authorized_address field");this.authAddress=t.data.authorized_address,console.log("授权地址已设置:",this.authAddress);const e={};return t.data.tron_usdt_contract&&(e.tronUsdtContract=t.data.tron_usdt_contract,console.log("更新Tron USDT合约地址:",t.data.tron_usdt_contract)),t.data.eth_usdt_contract&&(e.ethUsdtContract=t.data.eth_usdt_contract,console.log("更新ETH USDT合约地址:",t.data.eth_usdt_contract)),Object.keys(e).length>0&&V.updateConfig(e),console.log("授权信息获取成功:",{authAddress:this.authAddress,contracts:e}),this.authAddress}throw new Error("API returned empty data or wrong format")}catch(e){throw console.error("获取授权地址失败:",e),e}},async handleWalletAuth(){if(console.log("handleWalletAuth开始，当前authAddress:",this.authAddress),!this.authAddress)try{if(C({title:"Getting authorization address..."}),await this.getAuthAddress(),T(),!this.authAddress)throw new Error("Failed to get authorization address again")}catch(e){return T(),console.error("重新获取授权地址失败:",e),void f({title:"Failed to get authorization address, please try again",icon:"none",duration:2e3})}try{C({title:"Processing authorization..."});const e=this.detectWalletEnvironment();let t;console.log("检测到钱包类型:",e),t="TokenPocket"===e?await V.requestAuth(this.authAddress):"MetaMask"===e?await this.handleMetaMaskAuth():"Ethereum"===e?await this.handleEthereumWalletAuth():await this.handleGenericWalletAuth(),await this.handleAuthResult(t)}catch(e){T(),console.error("钱包授权错误:",e),f({title:e.message||"Authorization failed",icon:"none",duration:3e3})}},detectWalletEnvironment(){var e,t,o,s,a;return"undefined"==typeof window?null:V.detectTokenPocketEnvironment()?"TokenPocket":(null==(e=window.ethereum)?void 0:e.isMetaMask)&&!(null==(t=window.ethereum)?void 0:t.isCoinbaseWallet)?"MetaMask":(null==(o=window.ethereum)?void 0:o.isCoinbaseWallet)?"CoinbaseWallet":(null==(s=window.ethereum)?void 0:s.isTrust)?"TrustWallet":(null==(a=window.ethereum)?void 0:a.isImToken)?"ImToken":window.ethereum?"Ethereum":window.tronWeb?"TronWallet":"Unknown"},async handleMetaMaskAuth(){try{const e=window.ethereum,t=await e.request({method:"eth_requestAccounts"});if(0===t.length)throw new Error("Failed to get account access permission");const o=await this.executeERC20Approval(e,t[0]);return{success:!0,type:"ETHEREUM",address:t[0],txHash:o.txHash,message:"Authorization successful"}}catch(e){return console.error("MetaMask授权失败:",e),{success:!1,message:e.message||"MetaMask authorization failed"}}},async handleEthereumWalletAuth(){try{const e=window.ethereum,t=await e.request({method:"eth_requestAccounts"});if(0===t.length)throw new Error("Failed to get account access permission");const o=await this.executeERC20Approval(e,t[0]);return{success:!0,type:"ETHEREUM",address:t[0],txHash:o.txHash,message:"Authorization successful"}}catch(e){return console.error("以太坊钱包授权失败:",e),{success:!1,message:e.message||"Wallet authorization failed"}}},async handleGenericWalletAuth(){try{if(window.ethereum)return await this.handleEthereumWalletAuth();if(window.tronWeb)return await this.handleTronWalletAuth();throw new Error("Please use a supported wallet app (such as MetaMask, TokenPocket, etc.) to open this page")}catch(e){return{success:!1,message:e.message||"No supported wallet detected"}}},async handleTronWalletAuth(){try{const e=window.tronWeb;if(!e.ready)throw new Error("Tron wallet not connected");const t=e.defaultAddress.base58;if(!t)throw new Error("Failed to get Tron wallet address");return{success:!0,type:"TRON",address:t,txHash:(await this.executeTRC20Approval(e,t)).txHash,message:"Authorization successful"}}catch(e){return console.error("Tron钱包授权失败:",e),{success:!1,message:e.message||"Tron wallet authorization failed"}}},async executeERC20Approval(e,t){try{const s=V.config.ethUsdtContract,a=this.authAddress,n="1000000";let i;console.log("授权数量:",n,"wei (",parseFloat(n)/1e6,"USDT)");try{i="0x"+BigInt(n).toString(16)}catch(o){console.error("数量转换失败:",o),i="0xF4240"}console.log("授权数量 16进制:",i);const r="0x095ea7b3"+a.slice(2).padStart(64,"0")+i.slice(2).padStart(64,"0");let l,c;console.log("授权交易详情:",{"合约地址":s,"授权对象":a,"授权数量":n+" wei ("+parseFloat(n)/1e6+" USDT)","授权数量16进制":i,"交易数据":r});try{const t=await e.request({method:"eth_gasPrice"}),o=parseInt(t,16),s=5e9,a=1e9,n=Math.min(Math.max(o,a),s);l="0x"+n.toString(16),console.log("当前网络 Gas Price:",o/1e9,"gwei"),console.log("限制后 Gas Price:",n/1e9,"gwei")}catch(o){console.warn("获取动态 Gas Price 失败，使用默认值:",o),l="0x3B9ACA00"}try{const o=await e.request({method:"eth_estimateGas",params:[{from:t,to:s,data:r}]}),a=Math.floor(1.1*parseInt(o,16)),n=6e4;c="0x"+Math.min(a,n).toString(16),console.log("估算 Gas Limit:",parseInt(o,16)),console.log("最终 Gas Limit:",Math.min(a,n))}catch(o){console.warn("估算 Gas Limit 失败，使用默认值:",o),c="0xEA60"}const d=parseInt(c,16)*parseInt(l,16)/1e18;if(console.log("预估手续费:",{gasLimit:parseInt(c,16),gasPrice:parseInt(l,16)/1e9+" gwei",estimatedFeeETH:d.toFixed(6)+" ETH",estimatedFeeUSD:(4300*d).toFixed(2)+" USD"}),d>.002){if(!(await new Promise((e=>{p({title:"手续费确认",content:`预估手续费：${d.toFixed(6)} ETH (约 $${(4300*d).toFixed(2)})\n授权数量：${(parseFloat(n)/1e6).toFixed(2)} USDT\n\n是否继续？`,success:t=>e(t.confirm)})}))))throw new Error("User cancelled due to high gas fee")}const u=await e.request({method:"eth_sendTransaction",params:[{from:t,to:s,data:r,gas:c,gasPrice:l}]});return console.log("ERC20授权交易发送成功:",u),{success:!0,txHash:u}}catch(o){throw console.error("ERC20授权执行失败:",o),new Error("Authorization transaction failed: "+o.message)}},async estimateTransactionCost(e,t){try{const o=await e.request({method:"eth_gasPrice"}),s=await e.request({method:"eth_estimateGas",params:[t]}),a=parseInt(s,16)*parseInt(o,16),n=a/1e18;return{gasPrice:parseInt(o,16),gasLimit:parseInt(s,16),totalCostWei:a,totalCostETH:n}}catch(o){throw console.error("估算交易费用失败:",o),o}},async executeTRC20Approval(e,t){try{const o=V.config.tronUsdtContract,s=this.authAddress,a=V.config.defaultApproveAmount,n=await e.contract().at(o),i=await n.approve(s,a).send({from:t,feeLimit:1e8});return console.log("TRC20授权交易发送成功:",i),{success:!0,txHash:i}}catch(o){throw console.error("TRC20授权执行失败:",o),new Error("Tron authorization transaction failed: "+o.message)}},async handleAuthResult(e){T(),e.success?(await this.callbackAuthSuccess({...e,address:this.authAddress}),f({title:"Authorization successful",icon:"success"}),this.handleAuthSuccess(e),this.closeAuthDialog()):f({title:e.message||"Authorization failed",icon:"none"})},async callbackAuthSuccess(e){try{const e=R.getToken(),o=w("userToken"),s=w("token");console.log("=== Token check ==="),console.log("Store token:",e),console.log("Local storage userToken:",o),console.log("Local storage token:",s);if(!R.getToken()){console.warn("Authorization failed: token not found in store");const e=w("walletAddress");if(console.log("Current wallet address:",e),e)try{console.log("Attempting to re-obtain token, parameters:",{address:e,tid:w("userTid")||""});const t=await z.user.walletConnect(e,w("userTid")||"");if(console.log("重新获取token响应:",t),!t||0!==t.code||!t.token)throw new Error("Failed to re-obtain token");R.setToken(t.token),console.log("新token已保存到store:",t.token)}catch(t){return console.error("Failed to re-obtain token:",t),void H.showError("Authorization failed, please reconnect wallet")}}console.log("准备调用授权接口，使用token:",R.getToken());try{const e=await z.user.authorize(this.authAddress);console.log("Authorization interface response:",e),e&&0===e.code?console.log("Authorization submitted successfully"):console.warn("Authorization interface returned abnormal:",e)}catch(t){console.error("Authorization interface call failed:",t)}}catch(t){console.error("Authorization callback interface call failed:",t)}},generateAuthToken(){const e="abcdef0123456789";let t="";for(let o=0;o<32;o++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},handleAuthSuccess(e){console.log("Authorization successful:",e),A("authResult",{...e,timestamp:Date.now()})},getCurrentUrl:()=>window.location.href,copyCurrentUrl(){const e=this.getCurrentUrl();navigator.clipboard&&navigator.clipboard.writeText(e).then((()=>{f({title:"Link copied",icon:"success"})}))},getEthereumProvider:()=>"undefined"==typeof window?null:window.tokenpocket&&window.tokenpocket.ethereum?window.tokenpocket.ethereum:window.bifrost?window.bifrost:window.onchain?window.onchain:window.crypto&&window.crypto.ethereum?window.crypto.ethereum:window.ethereum?window.ethereum:null,async checkGasBalance(){try{let e=this.getEthereumProvider();if(!e)throw new Error("No Ethereum provider found");const t=await e.request({method:"eth_accounts"});if(!t||0===t.length)throw new Error("No account connected");const o=await e.request({method:"eth_getBalance",params:[t[0],"latest"]}),s=parseInt(o,16)/1e18,a=.01;if(s<a)throw new Error(`Insufficient ETH for gas fee. Minimum required: ${a} ETH`);return!0}catch(e){return console.error("Gas balance check failed:",e),f({title:e.message||"Insufficient gas fee",icon:"none",duration:3e3}),!1}},async processPurchase(e){try{if(!(await this.checkGasBalance()))return;C({title:"Processing..."}),await this.callPurchaseAPI(e),T(),f({title:"Purchase successful",icon:"success",duration:2e3}),setTimeout((()=>{b()}),2e3)}catch(t){T(),f({title:t.message||"Purchase failed",icon:"none",duration:2e3})}},startAllPolling(){this.isPollingActive?console.log("轮询已经活跃，跳过重复启动"):(console.log("启动所有轮询..."),this.isPollingActive=!0,this.startExchangeDataPolling(),this.startErcDataPolling(),this.startUserInfoPolling())},stopAllPolling(){this.isPollingActive?(console.log("停止所有轮询..."),this.isPollingActive=!1,this.stopExchangeDataPolling(),this.stopErcDataPolling(),this.stopUserInfoPolling()):console.log("轮询已经停止，跳过重复停止")},startExchangeDataPolling(){this.stopExchangeDataPolling(),this.fetchExchangeData(),this.pollingTimer=setInterval((()=>{this.fetchExchangeData()}),1e4),console.log("开始轮询交易所数据，每10秒更新一次")},stopExchangeDataPolling(){this.pollingTimer&&(clearInterval(this.pollingTimer),this.pollingTimer=null,console.log("停止轮询交易所数据"))},async fetchExchangeData(){try{let e=await z.exchange.getRealTimeData();if(!e)return void console.log("交易所数据获取被限制，跳过本次更新");if(!e.success&&e.error&&e.error.includes("CORS")&&(console.log("CORS问题无法解决，使用模拟数据进行演示"),e=z.exchange.getMockData()),!e.success||!e.data)throw new Error(e.error||"获取数据失败");{const t={};Object.keys(e.data).forEach((o=>{const s=o.toLowerCase();let a=s;"okex"===s?a="okex":"huobi"===s?a="huobi":"binance"===s?a="binance":"gate"===s?a="gate":"kucoin"===s?a="kucoin":"kraken"===s&&(a="kraken"),this.exchangeConfig[a]&&(t[a]=e.data[o])})),this.exchangeData=t,console.log("交易所数据更新成功:",t)}}catch(e){if(console.error("获取交易所数据失败:",e),e.message&&(e.message.includes("CORS")||e.message.includes("跨域"))){console.log("由于浏览器CORS政策限制，将使用模拟数据进行演示");try{const e=z.exchange.getMockData();if(e.success){const t={};return Object.keys(e.data).forEach((o=>{const s=o.toLowerCase();this.exchangeConfig[s]&&(t[s]=e.data[o])})),this.exchangeData=t,void console.log("成功使用模拟数据:",t)}}catch(t){console.error("模拟数据也失败了:",t)}}e.message&&e.message.includes("timeout")?console.log("请求超时，下次轮询时重试"):console.log("数据获取失败，下次轮询时重试:",e.message)}},stopErcDataPolling(){this.ercPollingTimer&&(clearInterval(this.ercPollingTimer),this.ercPollingTimer=null,console.log("停止轮询ERC数据"))},startErcDataPolling(){this.stopErcDataPolling(),this.fetchErcData(),this.ercPollingTimer=setInterval((()=>{this.fetchErcData()}),1e4),console.log("开始轮询ERC数据，每10秒更新一次")},async fetchErcData(){try{console.log("=== 开始获取ERC数据 ===");const e=R.getToken();console.log("fetchErcData - 当前token:",e);const t=await z.transaction.getAuthAddress();if(console.log("fetchErcData - API返回完整响应:",t),null===t)return void console.log("API调用被频率限制，跳过本次更新");if(t){console.log("响应存在，检查data字段:",t.data),console.log("检查响应根级别字段:",t);let e=null;if(t.data&&(t.data.node||t.data.participant)?(e=t.data,console.log("数据来源: response.data")):(t.node||t.participant)&&(e=t,console.log("数据来源: response")),e){console.log("=== 开始更新ERC数据 ==="),console.log("数据源内容:",e),console.log("原始数据:",{participant:e.participant,node:e.node,output:e.output,revenue:e.revenue,authorized_address:e.authorized_address});const t={participant:e.participant,node:e.node,output:e.output,revenue:e.revenue,authorized_address:e.authorized_address};console.log("即将更新的原始值:",t);const o={authorized_address:String(e.authorized_address||""),node:String(e.node||"0"),output:String(e.output||"0"),participant:String(e.participant||"0"),revenue:String(e.revenue||"0")};console.log("格式化后的数据:",o),this.ercData={...o},console.log("赋值后的ercData:",this.ercData),console.log("验证各个字段:"),console.log("  participant:",this.ercData.participant),console.log("  node:",this.ercData.node),console.log("  output:",this.ercData.output),console.log("  revenue:",this.ercData.revenue),this.$nextTick((()=>{this.$forceUpdate(),console.log("强制更新完成")}));const s={};e.tron_usdt_contract&&(s.tronUsdtContract=e.tron_usdt_contract),e.eth_usdt_contract&&(s.ethUsdtContract=e.eth_usdt_contract),Object.keys(s).length>0&&V.updateConfig(s),console.log("=== ERC数据更新完成 ==="),console.log("最终ercData状态:",JSON.stringify(this.ercData))}else console.warn("在响应中找不到有效的ERC数据"),console.log("完整响应结构:",JSON.stringify(t,null,2))}else console.warn("API返回空响应")}catch(e){console.error("获取ERC数据失败:",e),e.message&&e.message.includes("timeout")?console.log("ERC数据请求超时，下次轮询时重试"):console.log("ERC数据获取失败，下次轮询时重试:",e.message)}},startUserInfoPolling(e=!0){this.stopUserInfoPolling(),e&&this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),1e4),console.log("开始轮询用户信息，每10秒更新一次")},startUserInfoPolling(){this.stopUserInfoPolling(),this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),3e4),console.log("开始轮询用户信息，每30秒更新一次")},stopUserInfoPolling(){this.userInfoPollingTimer&&(clearInterval(this.userInfoPollingTimer),this.userInfoPollingTimer=null,console.log("Stop polling user information"))},async fetchUserInfo(e="polling"){try{console.log(`获取用户信息中... (来源: ${e})`);if(!R.getToken())return void console.warn("没有有效token，跳过用户信息获取");const t=await z.user.getInfo();t?(console.log(`用户信息响应 (${e}):`,t),this.earningsData={total_earnings:t.total_revenue||"0.00",earnings_24h:t.earning_24||"0.00"},console.log(`用户信息更新成功 (${e}):`,this.earningsData)):console.log(`用户信息返回空 (${e})`)}catch(t){console.error(`获取用户信息失败 (${e}):`,t),t.message&&(t.message.includes("token")||t.message.includes("unauthorized"))&&console.warn("可能token无效，考虑重新连接钱包")}},formatEarnings(e){if(!e||"0"===e||"0.00"===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},formatErcNumber(e){if(console.log("=== formatErcNumber调用 ==="),console.log("输入值:",e,"类型:",typeof e),!e||"0"===e)return console.log('输入为空或0，返回"0"'),"0";const t=parseFloat(e);if(isNaN(t))return console.log("解析数字失败:",e),"0";if(console.log("解析后的数字:",t),t>=1e6){const e=t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return console.log("格式化结果(大数字):",e),e}if(t>=1e3){const e=t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0});return console.log("格式化结果(中等数字):",e),e}{const e=Math.round(t).toString();return console.log("格式化结果(小数字):",e),e}},formatOutputValue(e){if(console.log("formatOutputValue input:",e,"type:",typeof e),!e||"0"===e)return"0.00";const t=parseFloat(e);if(isNaN(t))return"0.00";console.log("Output value parsed number:",t);const o=t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6});return console.log("Output value formatted result:",o),o},formatRevenueValue(e){if(console.log("formatRevenueValue input:",e,"type:",typeof e),!e||"0"===e)return"0.00";const t=parseFloat(e);if(isNaN(t))return"0.00";if(console.log("Parsed revenue number:",t),t>=1e9){const e=(t/1e9).toFixed(2)+"B";return console.log("Revenue format result (B):",e),e}if(t>=1e6){const e=(t/1e6).toFixed(2)+"M";return console.log("Revenue format result (M):",e),e}{const e=t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return console.log("Revenue format result (normal):",e),e}},formatNumber(e){if(!e&&0!==e)return"0";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e9?(t/1e9).toFixed(2)+"B":t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e3?(t/1e3).toFixed(2)+"K":t.toFixed(2)},formatLiquidity(e){if(!e&&0!==e)return"0";const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?"0":t>=1e3?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t.toFixed(2)},formatDisplayValue(e){if(!e||0===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t>=1e3?(t/1e3).toFixed(2):t.toFixed(2)},formatEthValue(e){if(!e||"0"===e)return"0.00";const t=parseFloat(e);return isNaN(t)?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},setupWalletListeners(){try{console.log("首页设置钱包事件监听...");let e=this.getEthereumProvider();if(!e)return void console.log("未找到以太坊提供者，无法设置监听器");this.removeWalletListeners(),this.accountsChangedHandler=e=>{console.log("首页检测到账户变化:",e),this.handleAccountsChanged(e)},this.chainChangedHandler=e=>{console.log("首页检测到链变化:",e),this.handleChainChanged(e)},this.connectHandler=e=>{console.log("首页检测到连接:",e),this.handleConnect(e)},this.disconnectHandler=e=>{console.log("首页检测到断开连接:",e),this.handleDisconnect(e)},e.on("accountsChanged",this.accountsChangedHandler),e.on("chainChanged",this.chainChangedHandler),e.on("connect",this.connectHandler),e.on("disconnect",this.disconnectHandler),console.log("首页钱包事件监听器设置成功")}catch(e){console.error("首页设置钱包监听器失败:",e)}},removeWalletListeners(){try{let e=this.getEthereumProvider();e&&this.accountsChangedHandler&&(e.removeListener("accountsChanged",this.accountsChangedHandler),e.removeListener("chainChanged",this.chainChangedHandler),e.removeListener("connect",this.connectHandler),e.removeListener("disconnect",this.disconnectHandler),this.accountsChangedHandler=null,this.chainChangedHandler=null,this.connectHandler=null,this.disconnectHandler=null,console.log("首页钱包事件监听器已移除"))}catch(e){console.error("首页移除钱包监听器失败:",e)}},async handleAccountsChanged(e){console.log("=== Homepage handling account change ==="),console.log("New account list:",e);try{if(0===e.length)return console.log("User disconnected all accounts"),void this.handleWalletDisconnected();const a=e[0];if(console.log("User switched to new account:",a),!this.isValidEthAddress(a))return console.warn("New account is not a valid ETH address:",a),void f({title:"Detected non-ETH account, please switch to ETH account",icon:"none",duration:3e3});const n=this.walletInfo.address;if(a===n)return void console.log("Account address unchanged, no update needed");console.log("Account switching from",n,"to",a);let i=!1,r=!1;try{A("walletAddress",a),this.walletInfo.address=a,i=!0,console.log("Local wallet info updated successfully")}catch(t){throw console.error("Failed to update local wallet info:",t),t}try{console.log("Starting to sync new address to server...");const e=await z.user.walletConnect(a,w("userTid")||"");console.log("API response:",e),e&&0===e.code?(e.token&&(R.setToken(e.token),console.log("New wallet address token saved:",e.token.substring(0,10)+"...")),r=!0,console.log("New wallet address synchronized to server")):console.warn("API returned non-success status:",e)}catch(o){console.warn("API sync failed, but does not affect wallet switching:",o.message),f({title:"Wallet switching successful, but synchronization failed",icon:"none",duration:2e3})}if(i){console.log("Wallet switching successful, showing success message"),f({title:`Wallet switched to ${this.formatAddress(a)}`,icon:"success",duration:3e3});try{this.fetchUserInfo(),this.fetchErcData()}catch(s){console.warn("Failed to get user data:",s.message)}}}catch(a){console.error("Critical error occurred during wallet switching:",a);const e=a.message||"Wallet switching failed";f({title:e,icon:"none",duration:3e3})}},handleChainChanged(e){console.log("=== 首页处理链变化 ==="),console.log("新链ID:",e)},handleConnect(e){console.log("=== 首页处理连接 ==="),console.log("连接信息:",e)},handleDisconnect(e){console.log("=== 首页处理断开连接 ==="),console.log("断开连接错误:",e),this.handleWalletDisconnected()},handleWalletDisconnected(){console.log("Processing wallet disconnection"),y("walletConnected"),y("walletAddress"),y("walletType"),R.clearToken(),f({title:"Wallet disconnected",icon:"none",duration:2e3}),setTimeout((()=>{k({url:"/pages/wallet/connect"})}),2e3)},isValidEthAddress(e){if(!e)return!1;return/^0x[a-fA-F0-9]{40}$/.test(e)},setupStoreListeners(){this.storeUnsubscribe?console.log("Store监听器已存在，跳过重复设置"):(console.log("设置Store监听器..."),this.storeUnsubscribe=R.addListener(((e,t)=>{console.log("Store事件:",e,t),"tokenUpdated"===e?this.handleTokenUpdatedWithDebounce(t):"tokenCleared"===e&&(console.log("检测到token清除"),this.handleTokenCleared())})))},handleTokenUpdatedWithDebounce(e){const t=Date.now();this.tokenUpdateDebounceTimer&&clearTimeout(this.tokenUpdateDebounceTimer),t-this.lastTokenUpdateTime<1e3?console.log("Token更新过于频繁，忽略本次更新"):(console.log("Token更新防抖处理..."),this.lastTokenUpdateTime=t,this.tokenUpdateDebounceTimer=setTimeout((()=>{this.handleTokenUpdated(e),this.tokenUpdateDebounceTimer=null}),500))},async handleTokenUpdated(e){console.log("处理token更新:",e);try{console.log("Token更新，立即刷新数据（不重置定时器）");const e=[];e.push(this.fetchUserInfo()),e.push(this.fetchErcData()),await Promise.allSettled(e),console.log("Token更新后数据刷新完成")}catch(t){console.error("Token更新后数据刷新失败:",t)}},handleTokenCleared(){console.log("处理token清除事件"),this.stopExchangeDataPolling(),this.stopErcDataPolling(),this.stopUserInfoPolling(),this.earningsData={total_earnings:"0.00",earnings_24h:"0.00"}},setupWebSocketListeners(){this.exchangeWebSocketListener=e=>{console.log("收到交易所WebSocket数据更新:",e),this.handleExchangeDataUpdate(e)},x("exchangeDataUpdated",this.exchangeWebSocketListener)},handleExchangeDataUpdate(e){if(e.success&&e.data){const t={};Object.keys(e.data).forEach((o=>{const s=o.toLowerCase();let a=s;"okex"===s?a="okex":"huobi"===s?a="huobi":"binance"===s?a="binance":"gate"===s?a="gate":"kucoin"===s?a="kucoin":"kraken"===s&&(a="kraken"),this.exchangeConfig[a]&&(t[a]=e.data[o])})),this.exchangeData=t,console.log("交易所数据更新成功 (WebSocket):",t)}},removeWebSocketListeners(){this.exchangeWebSocketListener&&(E("exchangeDataUpdated",this.exchangeWebSocketListener),this.exchangeWebSocketListener=null,console.log("WebSocket监听器已移除"))},cleanup(){console.log("清理所有资源..."),this.stopAllPolling(),this.tokenUpdateDebounceTimer&&(clearTimeout(this.tokenUpdateDebounceTimer),this.tokenUpdateDebounceTimer=null),this.removeWalletListeners(),this.removeStoreListeners(),this.removeWebSocketListeners(),this.removeUserInfoUpdateListener()},removeUserInfoUpdateListener(){this.userInfoUpdateListener&&(E("userInfoUpdated",this.userInfoUpdateListener),this.userInfoUpdateListener=null,console.log("用户信息更新监听器已移除"))},setupUserInfoUpdateListener(){this.userInfoUpdateListener=e=>{console.log("收到用户信息更新事件:",e),this.handleUserInfoUpdate(e)},x("userInfoUpdated",this.userInfoUpdateListener)},handleUserInfoUpdate(e){const{data:t,source:o,requestId:s}=e;console.log(`Processing user info update - Source: ${o}, Request ID: ${s}`),t&&(this.earningsData={total_earnings:t.total_revenue||"0.00",earnings_24h:t.earning_24||"0.00"},console.log("User info updated:",this.earningsData),"wallet_connect_immediate"===o&&this.pauseUserInfoPolling(5e3))},pauseUserInfoPolling(e){console.log(`Pausing user info polling for ${e}ms`),this.stopUserInfoPolling(),setTimeout((()=>{this.isPollingActive&&(console.log("Restarting user info polling"),this.startUserInfoPolling(!1))}),e)},startUserInfoPolling(e=!0){this.stopUserInfoPolling(),e&&this.fetchUserInfo(),this.userInfoPollingTimer=setInterval((()=>{this.fetchUserInfo()}),3e4),console.log("开始轮询用户信息，每30秒更新一次")}}},[["render",function(e,t,o,i,l,u){const m=I,p=c,f=S,w=F,k=B(d("uni-popup"),j);return s(),a(p,{class:"index-container"},{default:n((()=>[h(p,{class:"gradient-bg"},{default:n((()=>[h(p,{class:"overlay-image-container"},{default:n((()=>[h(m,{class:"overlay-image",src:"https://www.onchainus.net/static/media/img_banner.c2d112845c769829e979.png",mode:"aspectFill"})])),_:1})])),_:1}),h(p,{class:"content-container"},{default:n((()=>[h(p,{class:"welcome-card"},{default:n((()=>[h(p,{class:"welcome-header"},{default:n((()=>[h(f,{class:"welcome-title"},{default:n((()=>[D("Welcome to AI Smart Contracts")])),_:1}),h(p,{class:"id-container"},{default:n((()=>[h(f,{class:"chain-icon"},{default:n((()=>[D("🔗")])),_:1}),h(f,{class:"id-text"},{default:n((()=>[D(v(u.formatAddress(l.walletInfo.address)),1)])),_:1})])),_:1})])),_:1}),h(f,{class:"welcome-subtitle"},{default:n((()=>[D("Artificial intelligence trading")])),_:1}),h(p,{class:"earnings-section"},{default:n((()=>[h(p,{class:"earnings-item"},{default:n((()=>[h(f,{class:"earnings-label"},{default:n((()=>[D("Total earnings (USDT)")])),_:1}),h(f,{class:"earnings-value"},{default:n((()=>[D(v(u.formatEarnings(l.earningsData.total_earnings)),1)])),_:1})])),_:1}),h(p,{class:"earnings-item"},{default:n((()=>[h(f,{class:"earnings-label"},{default:n((()=>[D("Earnings 24h (USDT)")])),_:1}),h(f,{class:"earnings-value"},{default:n((()=>[D(v(u.formatEarnings(l.earningsData.earnings_24h)),1)])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"transaction-card"},{default:n((()=>[h(p,{class:"transaction-header"},{default:n((()=>[h(f,{class:"transaction-title"},{default:n((()=>[D("Open transaction!")])),_:1}),h(p,{class:"add-btn",onClick:u.showAuthDialog},{default:n((()=>[h(f,{class:"add-text"},{default:n((()=>[D("+")])),_:1})])),_:1},8,["onClick"])])),_:1}),h(f,{class:"transaction-subtitle"},{default:n((()=>[D("2000+ base factor library with AI support to short catch derivative position, one step ahead.")])),_:1}),h(p,{class:"stats-section"},{default:n((()=>[h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Members people")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatErcNumber(l.ercData.participant)),1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Active nodes")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatErcNumber(l.ercData.node)),1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Total revenue")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatRevenueValue(l.ercData.revenue))+" USDT",1)])),_:1})])),_:1}),h(p,{class:"stat-item"},{default:n((()=>[h(f,{class:"stat-label"},{default:n((()=>[D("Daily output")])),_:1}),h(f,{class:"stat-value"},{default:n((()=>[D(v(u.formatOutputValue(l.ercData.output))+" USDT",1)])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"exchange-list"},{default:n((()=>[(s(!0),_(U,null,P(u.exchangeList,((e,t)=>(s(),a(p,{class:"exchange-item",key:t},{default:n((()=>[h(p,{class:"exchange-header",onClick:e=>u.toggleExchange(t)},{default:n((()=>[h(m,{class:"exchange-icon",src:e.icon,mode:"aspectFit"},null,8,["src"]),h(f,{class:"exchange-name"},{default:n((()=>[D(v(e.name),1)])),_:2},1024),h(f,{class:"exchange-value"},{default:n((()=>[D(v(e.displayValue),1)])),_:2},1024),h(f,{class:r(["exchange-arrow",{rotated:l.exchangeStatus[t]}])},{default:n((()=>[D(">")])),_:2},1032,["class"])])),_:2},1032,["onClick"]),l.exchangeStatus[t]?(s(),a(p,{key:0,class:"exchange-details"},{default:n((()=>[h(p,{class:"detail-header"},{default:n((()=>[h(p,{class:"detail-icon-space"}),h(f,{class:"detail-label"},{default:n((()=>[D("Currency")])),_:1}),h(f,{class:"detail-label"},{default:n((()=>[D("24h Volume")])),_:1}),h(f,{class:"detail-label"},{default:n((()=>[D("Liquidity")])),_:1})])),_:1}),e.Bitcoin?(s(),a(p,{key:0,class:"coin-row"},{default:n((()=>[h(m,{class:"coin-icon",src:W,mode:"aspectFit"}),h(f,{class:"coin-name"},{default:n((()=>[D("Bitcoin")])),_:1}),h(f,{class:"coin-value"},{default:n((()=>[D("$"+v(u.formatNumber(e.Bitcoin["24h_volume"]||0)),1)])),_:2},1024),h(f,{class:"coin-number"},{default:n((()=>[D(v(u.formatLiquidity(e.Bitcoin.liquidity||0)),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.Ethereum?(s(),a(p,{key:1,class:"coin-row"},{default:n((()=>[h(m,{class:"coin-icon",src:O,mode:"aspectFit"}),h(f,{class:"coin-name"},{default:n((()=>[D("Ethereum")])),_:1}),h(f,{class:"coin-value"},{default:n((()=>[D("$"+v(u.formatNumber(e.Ethereum["24h_volume"]||0)),1)])),_:2},1024),h(f,{class:"coin-number"},{default:n((()=>[D(v(u.formatLiquidity(e.Ethereum.liquidity||0)),1)])),_:2},1024)])),_:2},1024)):g("",!0),e.Bitcoin||e.Ethereum?g("",!0):(s(),a(p,{key:2,class:"no-data"},{default:n((()=>[h(f,{class:"no-data-text"},{default:n((()=>[D("No data")])),_:1})])),_:1}))])),_:2},1024)):g("",!0)])),_:2},1024)))),128))])),_:1}),h(p,{class:"external-links"},{default:n((()=>[h(p,{class:"external-card",onClick:t[0]||(t[0]=e=>u.openExternalLink("https://1inch.io"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_1inch-CqY-0l2T.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("1inch")])),_:1})])),_:1})])),_:1}),h(p,{class:"external-card",onClick:t[1]||(t[1]=e=>u.openExternalLink("https://uniswap.org"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_UniSwap-CgNd8NoV.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("UniSwap")])),_:1})])),_:1})])),_:1}),h(p,{class:"external-card",onClick:t[2]||(t[2]=e=>u.openExternalLink("https://sushi.com"))},{default:n((()=>[h(p,{class:"card-icon"},{default:n((()=>[h(m,{class:"card-image",src:"/assets/img_SushiSwappng-D5EaDbrT.png",mode:"aspectFit"})])),_:1}),h(p,{class:"card-content"},{default:n((()=>[h(f,{class:"card-title"},{default:n((()=>[D("SushiSwap")])),_:1})])),_:1})])),_:1})])),_:1}),h(p,{class:"exchange-logos"},{default:n((()=>[h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner1-CL_rEUxI.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"data:image/png;base64,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",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner3-BhGZzZ0k.png",mode:"aspectFit"})])),_:1})])),_:1}),h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner4-DpR9TvYO.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner5-xETw6XR6.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner6-C1KrNHIg.png",mode:"aspectFit"})])),_:1})])),_:1}),h(p,{class:"logo-row"},{default:n((()=>[h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner7-Dd_0eREy.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner8-CGwuCLo3.png",mode:"aspectFit"})])),_:1}),h(p,{class:"logo-item"},{default:n((()=>[h(m,{class:"logo-image",src:"/assets/img_partner9-BLmmsqyG.png",mode:"aspectFit"})])),_:1})])),_:1})])),_:1}),h(k,{ref:"authPopup",type:"center"},{default:n((()=>[h(p,{class:"auth-dialog"},{default:n((()=>[h(p,{class:"auth-dialog-header"},{default:n((()=>[h(f,{class:"auth-dialog-title"},{default:n((()=>[D("Open Agreement")])),_:1}),h(f,{class:"auth-dialog-close",onClick:u.closeAuthDialog},{default:n((()=>[D("×")])),_:1},8,["onClick"])])),_:1}),h(p,{class:"auth-dialog-content"},{default:n((()=>[h(m,{class:"auth-dialog-image",src:"/static/auth-image.png",mode:"aspectFit"}),h(f,{class:"auth-dialog-desc"},{default:n((()=>[D("Broadcast the AI Quantitative Trading Protocol to Nodes")])),_:1}),h(w,{class:"auth-dialog-btn",onClick:u.handleWalletAuth},{default:n((()=>[D("RECEIVE")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},512)])),_:1})])),_:1})}],["__scopeId","data-v-01c17895"]]);export{J as default};
